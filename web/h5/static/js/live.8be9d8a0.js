(window.webpackJsonp=window.webpackJsonp||[]).push([["live"],{1185:function(t,e,i){"use strict";var s={name:"e-live-card",props:{course:{type:Object,default:function(){}}},computed:{status:function(){if("live"===this.course.type){var t=(new Date).getTime(),e=new Date(this.course.startTime),i=new Date(this.course.endTime);return t<=e?"nostart":t>i?"ungenerated"===this.course.activity.replayStatus?"end":"replay":"default"}}},filters:{liveStatusText:function(t){switch(t){case"replay":return"观看回放";case"default":return"正在直播";case"nostart":return"即将开始";case"end":return"已结束";default:return""}},liveBtnText:function(t){switch(t){case"replay":return"观看回放";case"default":return"进入教室";case"nostart":return"即将开始";case"end":return"暂无回放";default:return""}}},methods:{getStatusClass:function(t){switch(t){case"replay":return"live-status--end";case"default":return"live-status--start";case"nostart":return"live-status--default";case"end":default:return""}},getBtnClass:function(t){switch(t){case"replay":return"live-btn--default";case"default":return"live-btn--start";case"nostart":return"live-btn--default";case"end":return"live-btn--end";default:return""}},toClassroom:function(){this.$emit("toClassroom",this.course.classroom.id)},toTask:function(){if("end"!==this.status){var t={id:this.course.id,type:this.course.type,courseId:this.course.course.id};this.$emit("toTask",t)}},toCourse:function(){this.$emit("toCourse",this.course.course.id)}}},a=i("a6c2"),n=Object(a.a)(s,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"e-course-card"},[i("div",{staticClass:"live-list__item"},[i("div",{staticClass:"live-item__top",on:{click:function(e){return t.toCourse()}}},[i("span",[t._v(t._s(t.course.course.displayedTitle))]),i("i",{staticClass:"iconfont icon-arrow-right"})]),i("div",{staticClass:"live-item__content"},[i("div",{staticClass:"live-content__left"},[i("div",{staticClass:"live-content__title"},[i("i",{staticClass:"iconfont icon-zhibo"}),t._v("\n          "+t._s(t.course.activity.title)+"\n        ")]),i("div",{staticClass:"live-content__dec"},[i("span",{staticClass:"live-content__time"},[t._v(t._s(t._f("formateLiveTime")(t.course.startTime)))]),i("span",{class:t.getStatusClass(t.status)},[t._v("\n            "+t._s(t._f("liveStatusText")(t.status))+"\n            "),i("i",{directives:[{name:"show",rawName:"v-show",value:"default"===t.status,expression:" status==='default' "}],staticClass:"iconfont icon-zhibo1"})])])]),i("div",{staticClass:"live-content__right"},[i("div",{class:["live-btn",t.getBtnClass(t.status)],on:{click:function(e){return t.toTask()}}},[t._v(t._s(t._f("liveBtnText")(t.status)))])])]),t.course.classroom?i("div",{staticClass:"live-item__bottom van-hairline--top",on:{click:function(e){return t.toClassroom()}}},[i("span",[t._v(t._s(t.course.classroom.title))]),i("i",{staticClass:"iconfont icon-arrow-right"})]):t._e()])])}),[],!1,null,null,null);e.a=n.exports},"2d42":function(t,e,i){"use strict";var s={name:"e-empty",props:{text:{type:String,default:""}}},a=i("a6c2"),n=Object(a.a)(s,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"e-empty"},[e("img",{staticClass:"e-empty__img",attrs:{src:"static/images/empty.png"}}),e("p",{staticClass:"e-empty__text"},[this._v(this._s(this.text))])])}),[],!1,null,null,null);e.a=n.exports},7067:function(t,e,i){"use strict";i("e17f");var s=i("2241"),a=(i("e7e5"),i("d399")),n=i("a026"),r=i("3ce7"),o=/micromessenger/.test(navigator.userAgent.toLowerCase());e.a=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t||i&&!e)a.a.fail("缺少分享参数");else{var c={domainUri:location.origin,itemUri:"",source:"h5"};r.a.marketingActivities({query:{activityId:t},data:c}).then((function(t){var r=-1!==t.url.indexOf("?")?"&":"?",c=i?"".concat(e).concat(r,"ticket=").concat(t.ticket):t.url;o?window.location.href=c:s.a.confirm({message:"去微信完成活动",confirmButtonText:"复制链接",title:""}).then((function(){try{n.a.prototype.$copyText(c).then((function(){a.a.success("复制成功")}),(function(){a.a.fail("请更换浏览器复制")}))}catch(t){a.a.fail("请更换浏览器复制")}})).catch((function(){}))})).catch((function(t){a.a.fail(t.message)}))}}},"818d":function(t,e,i){},"89ae":function(t,e,i){"use strict";i.r(e),i("ac6a");var s=i("1185"),a=i("be6e"),n=i.n(a),r=i("2d42"),o=i("0d25"),c=(i("faa5"),i("3ce7")),u=(i("b383"),{name:"live-timetable",components:{Calendar:n.a,ECard:s.a,empty:r.a},data:function(){return{arr2:[],liveTime:[],liveHeight:null,today:"",liveCourse:[],isRequestComplete:!1,isScheduleTime:!1,isLiveCourse:!1,token:"",pullLoading:!1}},created:function(){this.setTitle(),this.getUserInfo()},computed:{noData:function(){return this.isRequestComplete&&!this.liveCourse.length}},mounted:function(){var t=this;this.$nextTick((function(){t.liveHeight=document.body.clientHeight-t.$refs.liveList.offsetTop,t.showToday()}))},methods:{setTitle:function(){window.postNativeMessage({action:"kuozhi_native_header",data:{title:"直播课表"}})},getliveSchedule:function(t){var e=this,i=this.getMonthTime(t);c.a.liveSchedule({params:i,headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Token":this.token}}).then((function(t){e.isScheduleTime=!0,e.setScheduleTime(t)})).catch((function(t){e.sendError(t)}))},setScheduleTime:function(t){var e="",i=[],s=new Date;t.forEach((function(t){var a=new Date(1e3*t.date);e=Object(o.compareDate)(a,s)?"mark1":"mark2",i.push({date:a.toLocaleDateString(),className:e})})),this.liveTime=i},getmyLiveCourse:function(t){var e=this,i=this.getDayTime(t);this.isRequestComplete=!1,c.a.myliveCourse({params:i,headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Token":this.token}}).then((function(t){e.isLiveCourse=!0,e.liveCourse=t,e.isRequestComplete=!0,e.pullLoading=!1})).catch((function(t){e.sendError(t)}))},clickDay:function(t){this.today=Object(o.formatFullTime)(new Date(t)),this.isLiveCourse&&this.getmyLiveCourse(new Date(t))},clickToday:function(t){},changeDate:function(t){this.isScheduleTime&&this.getliveSchedule(t)},showToday:function(){this.today=Object(o.formatFullTime)(new Date),this.$refs.Calendar.ChoseMonth(this.today)},getDayTime:function(t){var e=new Date(t);return{startTime:parseInt(e.setHours(0,0,0,0)/1e3),endTime:parseInt(e.setHours(23,59,59,999)/1e3)}},getMonthTime:function(t){var e=new Date(t);e.setDate(1),e.setHours(0),e.setSeconds(0),e.setMinutes(0);var i=new Date(t);return 11==e.getMonth()?i.setMonth(0):i.setMonth(e.getMonth()+1),i.setDate(1),i.setHours(0),i.setSeconds(0),i.setMinutes(0),{startTime:parseInt(e.getTime()/1e3),endTime:parseInt(i.getTime()/1e3)-1}},getUserInfo:function(){var t=this;window.nativeCallback=function(e){t.token=e.token,t.getliveSchedule(new Date),t.getmyLiveCourse(new Date)},window.postNativeMessage({action:"kuozhi_login_user",data:{force:1}})},toClassroom:function(t){window.postNativeMessage({action:"kuozhi_classroom",data:{classroomId:t}})},toTask:function(t){window.postNativeMessage({action:"kuozhi_learn_task",data:{taskId:t.id,taskType:t.type,courseId:t.courseId}})},toCourse:function(t){window.postNativeMessage({action:"kuozhi_course",data:{courseId:t}})},sendError:function(t){window.postNativeMessage({action:"kuozhi_h5_error",data:{code:t.code,message:t.message}})},initData:function(){this.liveCourse=[],this.isRequestComplete=!1},onRefresh:function(){this.initData(),this.getmyLiveCourse(new Date(this.today))}}}),l=(i("dac4"),i("a6c2")),d=Object(l.a)(u,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.pullLoading,callback:function(e){t.pullLoading=e},expression:"pullLoading"}},[i("div",{staticClass:"live-timetable app"},[i("Calendar",{ref:"Calendar",attrs:{markDateMore:t.liveTime,markDate:t.arr2},on:{isToday:t.clickToday,choseDay:t.clickDay,changeMonth:t.changeDate}}),i("div",{staticClass:"bg-gary"}),i("div",{ref:"liveList",staticClass:"live-list",style:{height:t.liveHeight+"px"}},[i("div",{staticClass:"live-list__title"},[i("div",{staticClass:"live-title__left"},[t._v("直播课表")]),i("div",{staticClass:"live-title__right"},[t._v(t._s(t.today))])]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isRequestComplete,expression:"!isRequestComplete"}],staticClass:"live-timetable-loading"},[i("van-loading",{attrs:{vertical:""}},[t._v("加载中...")])],1),t._l(t.liveCourse,(function(e,s){return t.isRequestComplete?i("e-card",{key:s,attrs:{course:e},on:{toClassroom:t.toClassroom,toTask:t.toTask,toCourse:t.toCourse}}):t._e()})),t.noData?i("empty",{staticClass:"empty__live",attrs:{text:"空空如也，暂无内容"}}):t._e()],2)],1)])}),[],!1,null,"08c7c45c",null);e.default=d.exports},"98c6":function(t,e,i){"use strict";i.r(e);var s=i("1185"),a=i("2d42"),n=i("0d25"),r=i("faa5"),o=i("3ce7"),c={name:"more-live",components:{ECard:s.a,empty:a.a},data:function(){return{today:"",liveCourse:[],isRequestComplete:!1,token:"",isLoad:!0,pullLoading:!1}},computed:{noData:function(){return this.isRequestComplete&&!this.liveCourse.length}},created:function(){this.setTitle(),this.getUserInfo(),this.today=Object(n.formatFullTime)(new Date)},beforeRouteLeave:function(){this.$store.commit(r.y)},methods:{setTitle:function(){window.postNativeMessage({action:"kuozhi_native_header",data:{title:"今日直播"}})},getmyLiveCourse:function(t){var e=this,i=this.getDayTime(t);o.a.myliveCourse({params:i,headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Token":this.token}}).then((function(t){e.liveCourse=t,e.isRequestComplete=!0,e.isLoad=!1,e.pullLoading=!1})).catch((function(t){e.sendError(t)}))},getDayTime:function(t){var e=new Date(t);return{startTime:parseInt(e.setHours(0,0,0,0)/1e3),endTime:parseInt(e.setHours(23,59,59,999)/1e3)}},getUserInfo:function(){var t=this;window.nativeCallback=function(e){t.token=e.token,t.getmyLiveCourse(new Date)},window.postNativeMessage({action:"kuozhi_login_user",data:{force:1}})},toClassroom:function(t){window.postNativeMessage({action:"kuozhi_classroom",data:{classroomId:t}})},toTask:function(t){t.id,t.type,t.courseId,window.postNativeMessage({action:"kuozhi_learn_task",data:{taskId:t.id,taskType:t.type,courseId:t.courseId}})},toCourse:function(t){window.postNativeMessage({action:"kuozhi_course",data:{courseId:t}})},sendError:function(t){window.postNativeMessage({action:"kuozhi_h5_error",data:{code:t.code,message:t.message}})},initData:function(){this.liveCourse=[],this.isRequestComplete=!1},onRefresh:function(){this.initData(),this.getmyLiveCourse(new Date)}}},u=i("a6c2"),l=Object(u.a)(c,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.pullLoading,callback:function(e){t.pullLoading=e},expression:"pullLoading"}},[i("div",{staticClass:"app live-timetable"},[i("div",{ref:"liveList",staticClass:"live-list"},[i("div",{staticClass:"live-list__title"},[i("div",{staticClass:"live-title__left"},[t._v("直播课表")]),i("div",{staticClass:"live-title__right"},[t._v(t._s(t.today))])]),i("div",{staticClass:"text-center mt20"},[i("van-loading",{directives:[{name:"show",rawName:"v-show",value:t.isLoad,expression:"isLoad"}],attrs:{size:"24px"}},[t._v("加载中...")])],1),t._l(t.liveCourse,(function(e,s){return t.isRequestComplete?i("e-card",{key:s,attrs:{course:e},on:{toClassroom:t.toClassroom,toTask:t.toTask,toCourse:t.toCourse}}):t._e()})),t.noData?i("empty",{staticClass:"empty__more-live",attrs:{text:"空空如也，暂无内容"}}):t._e()],2)])])}),[],!1,null,null,null);e.default=l.exports},a56c:function(t,e,i){"use strict";i.r(e),i("8e6e"),i("ac6a"),i("456d"),i("e7e5");var s=i("d399"),a=(i("96cf"),i("3b8d")),n=i("bd86"),r=i("3ce7"),o=i("2f62"),c=i("faa5"),u=i("d863"),l=i("c8a5");function d(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function h(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?d(Object(i),!0).forEach((function(e){Object(n.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var v={mixins:[u.a,l.a],data:function(){return{playUrl:"",requestCount:0,courseId:"",taskId:""}},computed:h(h({},Object(o.d)("course",{joinStatus:function(t){return t.joinStatus}})),Object(o.d)({isLoading:function(t){return t.isLoading}})),mounted:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.courseId=t.$route.query.courseId,t.taskId=t.$route.query.taskId,t.$store.state.token){e.next=5;break}return t.$router.push({name:"login",query:{redirect:t.redirect}}),e.abrupt("return");case 5:t.handleLive();case 6:case"end":return e.stop()}}),e)})))()},methods:h(h({},Object(o.c)({setNavbarTitle:c.n})),{},{handleLive:function(){var t=this.$route.query,e=t.taskId,i=t.replay,s=t.title;if(this.setNavbarTitle(s),"true"==String(i))return this.initReportData(this.courseId,this.taskId,"live",!0),void this.getReplayUrl(e);this.initReportData(this.courseId,this.taskId,"live",!1),this.requestLiveNo(e)},getReplayUrl:function(t){var e=this;r.a.getLiveReplayUrl({query:{taskId:t}}).then((function(t){if(t.nonsupport)Object(s.a)("回放暂不支持");else if(t.url)if(t.url.indexOf("/error/")>-1)Object(s.a)("暂无回放");else{e.reprtData("finish");var i=t.url.indexOf("/");e.playUrl=0==i?t.url:t.url.substring(i)}else t.error&&s.a.fail(t.error.message)})).catch((function(t){s.a.fail(t.message)}))},requestLiveNo:function(t){var e=this;r.a.requestLiveNo({query:{taskId:t}}).then((function(i){i.no&&e.getLiveUrl(t,i.no),i.error&&s.a.fail(i.error.message)})).catch((function(t){s.a.fail(t.message)}))},getLiveUrl:function(t,e){var i=this;this.requestCount++,r.a.getLiveUrl({query:{taskId:t,no:e}}).then((function(a){if(a.roomUrl){var n=a.roomUrl.indexOf("/");i.playUrl=0==n?a.roomUrl:a.roomUrl.substring(n),i.reprtData("finish")}else i.requestCount<30?i.getLiveUrl(t,e):Object(s.a)("获取直播失败");a.error&&s.a.fail(a.error.message)})).catch((function(t){s.a.fail(t.message)}))}})},f=i("a6c2"),p=Object(f.a)(v,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"web-view"},[this.isLoading?e("e-loading"):this._e(),e("iframe",{attrs:{id:"player",src:this.playUrl,width:"100%",frameborder:"0"}})],1)}),[],!1,null,null,null);e.default=p.exports},c8a5:function(t,e,i){"use strict";var s=i("3ce7"),a=i("faa5");e.a={data:function(){return{reportIntervalTime:null,reportLearnTime:null,reportFinishCondition:null,reportData:{courseId:null,taskId:null},reportResult:null,isFinish:!1,reportType:null,learnTime:0}},beforeDestroy:function(){this.clearReportIntervalTime()},methods:{initReportData:function(t,e,i){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.clearReportIntervalTime(),this.reportData={courseId:t,taskId:e},this.reportType=i,this.isFinish=!1,this.reportIntervalTime=null,this.reportLearnTime=null,this.reportResult=null,this.learnTime=0,this.reportFinishCondition=null,s&&this.initReportEvent()},initReportEvent:function(){this.reprtData(),this.intervalReportData(),this.intervalReportLearnTime()},getCourseData:function(t,e){var i=this,a={courseId:t,taskId:e};return new Promise((function(t,e){s.a.getCourseData({query:a}).then((function(e){i.reportFinishCondition=e.activity.finishCondition,t(e)})).catch((function(t){e(t)}))}))},reprtData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"doing",i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!==this.reportData.courseId&&null!==this.reportData.taskId&&(!this.isFinish||i)){var n={};if("doing"===e){if(null!==this.reportResult){var r=this.reportResult.lastTime;n={lastTime:r}}a&&(n.watchTime=a)}var o={courseId:this.reportData.courseId,taskId:this.reportData.taskId,events:e};return new Promise((function(e,i){s.a.reportTask({query:o,data:n}).then((function(i){t.handleReprtResult(i),e(i)})).catch((function(t){i(t)}))}))}},handleReprtResult:function(t){this.reportResult=t,"finish"===t.result.status?(this.isFinish=!0,this.$store.commit(a.r,"finish"),this.$store.commit("course/".concat(a.v),t.completionRate)):this.$store.commit(a.r,"start")},intervalReportLearnTime:function(){var t=this;this.reportLearnTime=setInterval((function(){t.checkoutTime(),t.learnTime++}),1e3)},intervalReportData:function(){var t=this,e=60*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*1e3;this.reportIntervalTime=setInterval((function(){t.reprtData("doing",!0)}),e)},checkoutTime:function(){this.reportFinishCondition&&"time"===this.reportFinishCondition.type&&parseInt(this.learnTime/60,10)>=parseInt(this.reportFinishCondition.data,10)&&this.reprtData("finish")},clearReportIntervalTime:function(){clearInterval(this.reportIntervalTime),clearInterval(this.reportLearnTime),this.reportIntervalTime=null,this.reportLearnTime=null}}}},d863:function(t,e,i){"use strict";i("a481");var s=i("7067");e.a={data:function(){return{redirect:""}},created:function(){this.redirect=decodeURIComponent(this.$route.fullPath)},methods:{afterLogin:function(){var t=this,e=this.$route.query.redirect?decodeURIComponent(this.$route.query.redirect):"/",i=this.$route.query.skipUrl?decodeURIComponent(this.$route.query.skipUrl):"",a=this.$route.query.callbackType,n=this.$route.query.activityId,r=decodeURIComponent(this.$route.query.callback);setTimeout((function(){if(a)switch(a){case"marketing":Object(s.a)(n,r)}else i?t.$router.replace({path:e,query:{backUrl:i}}):t.$router.replace({path:e})}),2e3)}}}},dac4:function(t,e,i){"use strict";var s=i("818d");i.n(s).a}}]);