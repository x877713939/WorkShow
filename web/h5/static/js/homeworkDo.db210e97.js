(window.webpackJsonp=window.webpackJsonp||[]).push([["homeworkDo"],{"057e":function(t,e,i){"use strict";i("8e6e"),i("ac6a"),i("456d");var r=i("bd86"),n=i("2f62");function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}var s={name:"GuidePage",data:function(){return{isFristVisited:!1}},computed:function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach((function(e){Object(r.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},Object(n.d)({user:function(t){return t.user}})),created:function(){this.setVisited()},methods:{setVisited:function(){var t="".concat(this.user.id,"-task-visited");localStorage.getItem(t),localStorage.getItem(t)||(this.isFristVisited=!0,localStorage.setItem(t,!0))}}},a=i("a6c2"),c=Object(a.a)(s,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.isFristVisited,expression:"isFristVisited"}],staticClass:"guide",on:{click:function(e){t.isFristVisited=!1}}},[i("div",{staticClass:"guide__text"},[t._v("左右切换滑动")]),t._m(0)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"guide__gesture"},[e("img",{attrs:{src:"static/images/leftslide.png"}}),e("img",{attrs:{src:"static/images/rightslide.png"}})])}],!1,null,null,null);e.a=c.exports},3841:function(t,e,i){"use strict";i.r(e),i("8e6e"),i("a481"),i("456d"),i("c5f6"),i("ac6a"),i("e7e5");var r=i("d399"),n=(i("e17f"),i("2241")),o=i("bd86"),s=i("3ce7"),a=i("faa5"),c=i("2f62"),u=i("057e"),l=i("f5cc"),h=i("ea9a"),d=i("8ae7"),f=i("c8a5");function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function p(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(Object(i),!0).forEach((function(e){Object(o.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var w="",v={name:"HomeworkDo",components:{itemBank:l.a,guidePage:u.a},mixins:[h.a,d.a,f.a],data:function(){var t;return t={info:[],answer:{},lastAnswer:null,cardSeq:0,homework:null,cardShow:!1,localanswerName:null,localtimeName:null,lastUsedTime:null},Object(o.a)(t,"lastAnswer",null),Object(o.a)(t,"usedTime",null),Object(o.a)(t,"isHandHomework",!1),Object(o.a)(t,"slideIndex",0),t},computed:p({},Object(c.d)({isLoading:function(t){return t.isLoading},user:function(t){return t.user}})),watch:{answer:{handler:"saveAnswer",deep:!0}},created:function(){this.getData(),this.initReport()},beforeRouteEnter:function(t,e,i){w="/"===e.fullPath?"/":"",i()},beforeRouteLeave:function(t,e,i){0==this.info.length||this.isHandHomework||"doing"!=this.homework.status?i():this.submitpaper().then((function(){i()})).catch((function(){i(!1)}))},beforeDestroy:function(){this.clearTime(),n.a.close()},methods:p(p(p({},Object(c.c)({setNavbarTitle:a.n})),Object(c.b)("course",["handHomeworkdo"])),{},{initReport:function(){this.initReportData(this.$route.query.courseId,this.$route.query.targetId,"homework")},getData:function(){var t=this,e=this.$route.query.homeworkId,i=this.$route.query.targetId;this.$route.query.action,s.a.getHomeworkInfo({query:{homeworkId:e},data:{targetId:i,targetType:"task"}}).then((function(e){t.afterGetData(e)})).catch((function(e){var i=r.a.fail(e.message);"4036706"==e.code&&setTimeout((function(){t.toIntro(),i.clear()}),2e3)}))},afterGetData:function(t){this.setNavbarTitle(t.paperName),this.homework=t,this.isDoing()||(this.getLocalData(),this.formatData(t),this.interruption(),this.saveTime())},isDoing:function(){return"doing"!=this.homework.status&&(this.showResult(),!0)},interruption:function(){var t=this;this.$route.params.KeepDoing||this.canDoing(this.homework,this.user.id).then((function(){})).catch((function(e){var i=e.answer;t.submitHomework(i)}))},formatData:function(t){var e=this;t.items.forEach((function(t){if("material"!=t.type){var i=e.sixType(t.type,t,e.lastAnswer);e.$set(e.answer,t.id,i.answer),e.info.push(i.item)}if("material"==t.type){var r=Object.assign({},t,{subs:""});t.subs.forEach((function(i,n){i.parentTitle=r,i.parentType=t.type,i.materialIndex=n+1;var o=e.sixType(i.type,i,e.lastAnswer);e.$set(e.answer,i.id,o.answer),e.info.push(o.item)}))}}))},formatStatus:function(t,e){var i=0;return("single_choice"==t||"choice"==t||"uncertain_choice"==t||"determine"==t)&&this.answer[e].length>0||"essay"==t&&""!=this.answer[e][0]?i=1:"fill"==t?i=Number(this.answer[e].some((function(t){return""!=t}))):i},slideToNumber:function(t){var e=Number(t);this.cardSeq=e,this.cardShow=!1},getLocalData:function(){this.localanswerName="homework-".concat(this.user.id,"-").concat(this.homework.id),this.localuseTime="homework-".concat(this.user.id,"-").concat(this.homework.id,"-usedTime"),this.lastAnswer=JSON.parse(localStorage.getItem(this.localanswerName))},saveAnswer:function(t){localStorage.setItem(this.localanswerName,JSON.stringify(t))},saveTime:function(){var t=this,e=localStorage.getItem(this.localuseTime)||0;this.usedTime=setInterval((function(){localStorage.setItem(t.localuseTime,++e)}),1e3)},clearTime:function(){clearInterval(this.usedTime),this.usedTime=null},submitpaper:function(){var t=this,e=0,i="题目已经做完，确认提交吗?",r=JSON.parse(JSON.stringify(this.answer));return Object.keys(r).forEach((function(t){r[t]=r[t].filter((function(t){return""!==t})),0===r[t].length&&e++})),e>0&&(i="还有".concat(e,"题未做，确认提交吗？")),new Promise((function(e,o){n.a.confirm({title:"提交",cancelButtonText:"立即提交",confirmButtonText:"检查一下",message:i}).then((function(){t.cardShow=!0,o()})).catch((function(){t.clearTime(),t.submitHomework(r).then((function(t){e()})).catch((function(t){o()}))}))}))},submitHomework:function(t){var e=this;t||(t=JSON.parse(JSON.stringify(this.answer)),Object.keys(t).forEach((function(e){t[e]=t[e].filter((function(t){return""!==t}))})));var i={answer:t,homeworkId:this.$route.query.homeworkId,userId:this.user.id,homeworkResultId:this.homework.id};return new Promise((function(t,n){e.handHomeworkdo(i).then((function(i){e.isHandHomework=!0,t(),e.reprtData("finish"),e.showResult()})).catch((function(i){var o=r.a.fail(i.message);"4036705"==i.code?setTimeout((function(){e.isHandHomework=!0,o.clear(),t(),e.showResult()}),2e3):n()}))}))},showResult:function(){this.$router.replace({name:"homeworkResult",query:{homeworkId:this.$route.query.homeworkId,homeworkResultId:this.homework.id,taskId:this.$route.query.targetId,backUrl:w,courseId:this.$route.query.courseId}})},toIntro:function(){this.$router.replace({name:"homeworkIntro",query:{courseId:this.$route.query.courseId,taskId:this.$route.query.targetId,backUrl:w}})}})},g=i("a6c2"),b=Object(g.a)(v,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"paper-swiper"},[t.isLoading?i("e-loading"):t._e(),t.info.length>0?i("item-bank",{attrs:{current:t.cardSeq,info:t.info,answer:t.answer,"show-score":!1,"slide-index":t.slideIndex,all:t.info.length},on:{"update:current":function(e){t.cardSeq=e},"update:answer":function(e){t.answer=e},"update:slideIndex":function(e){t.slideIndex=e},"update:slide-index":function(e){t.slideIndex=e}}}):t._e(),i("guide-page"),i("div",{staticClass:"paper-footer"},[i("div",[i("span",{on:{click:function(e){t.cardShow=!0}}},[i("i",{staticClass:"iconfont icon-Questioncard"}),t._v("\n        题卡\n      ")])]),i("div",[i("span",{on:{click:t.submitpaper}},[i("i",{staticClass:"iconfont icon-submit"}),t._v("\n        提交\n      ")])])]),i("van-popup",{attrs:{position:"bottom"},model:{value:t.cardShow,callback:function(e){t.cardShow=e},expression:"cardShow"}},[t.info.length>0?i("div",{staticClass:"card"},[i("div",{staticClass:"card-title"},[i("div",[i("span",{staticClass:"card-finish"},[t._v("已完成")]),i("span",{staticClass:"card-nofinish"},[t._v("未完成")])]),i("i",{staticClass:"iconfont icon-no",on:{click:function(e){t.cardShow=!1}}})]),i("div",{staticClass:"card-list"},[i("div",{staticClass:"card-homework-item"},[i("div",{staticClass:"card-item-list"},t._l(t.info,(function(e){return i("div",{key:e.id,class:["list-cicle",1==t.formatStatus(e.type,e.id)?"cicle-active":""],on:{click:function(i){return t.slideToNumber(e.seq)}}},[t._v(t._s(e.seq))])})),0)])])]):t._e()])],1)}),[],!1,null,null,null);e.default=b.exports},c8a5:function(t,e,i){"use strict";var r=i("3ce7"),n=i("faa5");e.a={data:function(){return{reportIntervalTime:null,reportLearnTime:null,reportFinishCondition:null,reportData:{courseId:null,taskId:null},reportResult:null,isFinish:!1,reportType:null,learnTime:0}},beforeDestroy:function(){this.clearReportIntervalTime()},methods:{initReportData:function(t,e,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.clearReportIntervalTime(),this.reportData={courseId:t,taskId:e},this.reportType=i,this.isFinish=!1,this.reportIntervalTime=null,this.reportLearnTime=null,this.reportResult=null,this.learnTime=0,this.reportFinishCondition=null,r&&this.initReportEvent()},initReportEvent:function(){this.reprtData(),this.intervalReportData(),this.intervalReportLearnTime()},getCourseData:function(t,e){var i=this,n={courseId:t,taskId:e};return new Promise((function(t,e){r.a.getCourseData({query:n}).then((function(e){i.reportFinishCondition=e.activity.finishCondition,t(e)})).catch((function(t){e(t)}))}))},reprtData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"doing",i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!==this.reportData.courseId&&null!==this.reportData.taskId&&(!this.isFinish||i)){var o={};if("doing"===e){if(null!==this.reportResult){var s=this.reportResult.lastTime;o={lastTime:s}}n&&(o.watchTime=n)}var a={courseId:this.reportData.courseId,taskId:this.reportData.taskId,events:e};return new Promise((function(e,i){r.a.reportTask({query:a,data:o}).then((function(i){t.handleReprtResult(i),e(i)})).catch((function(t){i(t)}))}))}},handleReprtResult:function(t){this.reportResult=t,"finish"===t.result.status?(this.isFinish=!0,this.$store.commit(n.r,"finish"),this.$store.commit("course/".concat(n.v),t.completionRate)):this.$store.commit(n.r,"start")},intervalReportLearnTime:function(){var t=this;this.reportLearnTime=setInterval((function(){t.checkoutTime(),t.learnTime++}),1e3)},intervalReportData:function(){var t=this,e=60*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*1e3;this.reportIntervalTime=setInterval((function(){t.reprtData("doing",!0)}),e)},checkoutTime:function(){this.reportFinishCondition&&"time"===this.reportFinishCondition.type&&parseInt(this.learnTime/60,10)>=parseInt(this.reportFinishCondition.data,10)&&this.reprtData("finish")},clearReportIntervalTime:function(){clearInterval(this.reportIntervalTime),clearInterval(this.reportLearnTime),this.reportIntervalTime=null,this.reportLearnTime=null}}}},ea9a:function(t,e,i){"use strict";i("e17f");var r=i("2241");i("456d"),i("ac6a"),e.a={methods:{canDoing:function(t,e){return new Promise((function(i,n){if(t&&"doing"===t.status){var o="homework-".concat(e,"-").concat(t.id),s=JSON.parse(localStorage.getItem(o));s=s?Object.keys(s).forEach((function(t){s[t]=s[t].filter((function(t){return""!==t}))})):{},r.a.confirm({title:"提示",cancelButtonText:"放弃做题",confirmButtonText:"继续做题",message:"您有未完成的作业，是否继续？"}).then((function(){i()})).catch((function(){n({answer:s})}))}}))}}}}}]);