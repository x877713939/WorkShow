!function(l){function e(e){for(var t,i,n=e[0],a=e[1],r=e[2],o=0,s=[];o<n.length;o++)i=n[o],Object.prototype.hasOwnProperty.call(u,i)&&u[i]&&s.push(u[i][0]),u[i]=0;for(t in a)Object.prototype.hasOwnProperty.call(a,t)&&(l[t]=a[t]);for(m&&m(e);s.length;)s.shift()();return c.push.apply(c,r||[]),d()}function d(){for(var e,t=0;t<c.length;t++){for(var i=c[t],n=!0,a=1;a<i.length;a++){var r=i[a];0!==u[r]&&(n=!1)}n&&(c.splice(t--,1),e=o(o.s=i[0]))}return e}var i={},u={181:0},c=[];function o(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return l[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=l,o.c=i,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/static-dist/";var t=window.webpackJsonp=window.webpackJsonp||[],n=t.push.bind(t);t.push=e,t=t.slice();for(var a=0;a<t.length;a++)e(t[a]);var m=n;c.push([734,0]),d()}({351:function(e,t){var i="<iframe src='"+$("#task-dashboard").data("media-player")+"' name='viewerIframe' id='viewerIframe' width='100%'allowfullscreen webkitallowfullscreen height='100%' style='border:0px'></iframe>";$("#task-video-content").html(i)},734:function(e,t,i){"use strict";i.r(t);var t=i(6),r=i.n(t),t=i(0),h=i.n(t),t=i(1),n=i.n(t),a=(i(351),new(i(89).a)({name:"parent",project:"PlayerProject",children:[document.getElementById("viewerIframe")],type:"parent"})),f=i(16),s=function(){function m(e){var t=e.element,i=e.initMarkerArry,n=void 0===i?[]:i,a=e._video_time,r=void 0===a?"18":a,o=e.messenger,s=void 0===o?{}:o,l=e.editbox,d=void 0===l?".editbox":l,u=e.scalebox,c=e.timepartnum,i=void 0===c?"6":c,a=e.markers_array,o=void 0===a?new Array:a,l=e.addScale,u=e.mergeScale,c=e.updateScale,a=e.deleteScale,e=e.updateSeq;h()(this,m),this.$element=$(t),this.initMarkerArry=n,this.markers_array=o,this._video_time=r,this.messenger=s,this.editbox=d,this.timepartnum=i,this.courseId=this.$element.data("course-id"),this.addScale=l,this.mergeScale=u,this.updateScale=c,this.deleteScale=a,this.updateSeq=e,this.init()}return n()(m,[{key:"init",value:function(){this.initSortable(),this.initeditbox(!1),this.initMarker(this.initMarkerArry),this.lisentresize(),this.initPlayer(),this.initEvent()}},{key:"initEvent",value:function(){var t=this;this.$element.on("mousedown",".gruop-lesson-list .drag",function(e){return t.itemDraggable(e)}),this.$element.on("click",'.lesson-list [data-role="question-remove"]',function(e){return t.itemRmove(e)}),this.$element.on("click","#subject-lesson-list .item-lesson",function(e){return t.stopEvent(e)}),this.$element.on("mousedown",".scale-blue",function(e){return t.slideScale(e)}),this.$element.on("mouseenter",".scale-blue",function(e){return t.hoverScale(e)}),this.$element.on("mousedown",".js-question-preview",function(e){return t.previewMouseDown(e)})}},{key:"initPlayer",value:function(){var t=this.messenger,i=this,n=!0,a=$("#editbox-lesson-list");t.on("timechange",function(e){n&&$(".scale-white").css("left",i.getleft(e.currentTime))}),$(".scale-white").on("mousedown",function(e){n=!1,$(document).on("mousemove.playertime",function(e){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();e=e.pageX>a.width()+20?a.width()+20:e.pageX&&e.pageX<=20?20:e.pageX;$(".scale-white").css("left",e);e=i.gettime(e);t.sendToChild({id:"viewerIframe"},"setCurrentTime",{time:e})}).on("mouseup.playertime",function(e){$(document).off("mousemove.playertime"),$(document).off("mousedown.playertime"),n=!0})})}},{key:"initSortable",value:function(){var n=this;$("#subject-lesson-list").sortable({group:"no-drop",drop:!1,delay:500,handle:".drag",onDrop:function(e,t,i){e.hasClass("item-lesson")&&(i(e,t),0<(e=e.closest(".scale.blue")).find(".lesson-list .item-lesson").length&&(n.sortList(e.find(".lesson-list")),n.addScale(e,e.find(".time").html(),e.css("left"),e.find(".lesson-list").children().length)))}}),$("#editbox-lesson-list").sortable({group:"no-drop",drag:!1})}},{key:"sortList",value:function(e){var t=1;e.find(".item-lesson").each(function(){$(this).find('[data-role="sqe-number"]').text(t),t++})}},{key:"addScale",value:function(e,t,i,n){var a=e.find("li:last"),a={id:e.attr("id"),second:t,questionMarkers:[{id:a.attr("id"),seq:i,questionId:a.attr("question-id")}]};$.extend(this.addScale(a,e,n))}},{key:"initeditbox",value:function(e){var t=this,i=$(t.editbox);if(e)i.find(".scale.scale-default:visible").each(function(){$(this).css("left",t.getleft(f.k($(this).find('[data-role="scale-time"]').text())))}),i.find(".scale.scale-blue:visible").each(function(){$(this).css("left",t.getleft(f.k($(this).find('[data-role="scale-blue-time"]').text())))});else for(var n=t.timepartnum,a=t._video_time/n,r=0;r<=n;r++){var o=$('[data-role="scale-default"]').clone().css("left",t.getleft(a*r)).removeClass("hidden").removeAttr("data-role");o.find('[data-role="scale-time"]').text(f.i(Math.round(a*r))),$('[data-role="scale-default"]').before(o)}}},{key:"initMarker",value:function(e){if(0<e.length){for(var t=$('[data-role="scale-blue"]'),i=0;i<e.length;i++){for(var n=t.clone().css("left",this.getleft(e[i].second)).removeAttr("data-role").removeClass("hidden").attr("id",e[i].id),a=(n.find('[data-role="scale-blue-time"]').text(f.i(e[i].second)),e[i].questionMarkers),r=n.find('[data-role="scale-blue-item"]'),o=0;o<a.length;o++){var s=r.clone().removeAttr("data-role").attr({"question-id":a[o].questionId,id:a[o].id});console.log("new_scale_blue_item",s),s.data("url","/course/".concat(this.courseId,"/question/").concat(a[o].questionId,"/marker/preview")).find('[data-role="sqe-number"]').text(o+1).end().find('[data-role="question-type"]').text(Translator.trans("course.question.type.single_choice")).end().find('[data-role="question-info"]').text(a[o].question.stem.replace(/<.*?>/gi,"")),r.before(s)}t.after(n),r.remove(),this.markers_array.push({id:e[i].id,time:e[i].second})}this.newSortList($(this.scalebox).find('[data-role="scale-blue-list"]'))}}},{key:"lisentresize",value:function(){var e=this;$(window).resize(function(){e.initeditbox(!0)})}},{key:"getleft",value:function(e){return 20+e*$("#editbox-lesson-list").width()/r()(this._video_time)}},{key:"newSortList",value:function(e){var a=this;e.sortable({delay:500,itemSelector:".item-lesson",onDrop:function(e,t,i){i(e,t),a.maskShow(!1);var e=e.closest(".scale-blue"),n={id:"",questionMarkers:[]};n.id=e.attr("id"),a.sortList(e.find('[data-role="scale-blue-list"]')),e.find("li").each(function(){var e={id:$(this).attr("id"),seq:$(this).find('[data-role="sqe-number"]').html()};n.questionMarkers.push(e)}),a._updateSeq(e,n),e.removeClass("moveing")},serialize:function(e,t,i){return i?t:e.attr("id")},isValidTarget:function(e){return a.maskShow(!0),e.closest(".scale-blue").addClass("moveing"),!0}})}},{key:"maskShow",value:function(e){e?$('[data-role="player-mask"]').removeClass("hidden"):$('[data-role="player-mask"]').addClass("hidden")}},{key:"gettime",value:function(e){return Math.round((e-20)*this._video_time/$("#editbox-lesson-list").width())}},{key:"itemDraggable",value:function(e){var r=this,o=[],s=null,l=null,d=null,e=$(e.currentTarget),u=$("#editbox-lesson-list"),c=$('[data-role="scale-red"]'),i=c.find('[data-role="scale-red-details"]'),m=e.clone().removeClass("drag").addClass("disdragg");e.after(m),r.maskShow(!0),$(document).on("mousemove.dragitem",function(e){if(u.find(".placeholder").length<=0)return c.addClass("hidden"),void u.removeClass("highlight");if(u.addClass("highlight"),l=e.pageX>u.width()+20?u.width()+20:e.pageX&&e.pageX<=20?20:e.pageX,d=r.gettime(l),i.text(f.i(d)),c.removeClass("hidden").css("left",l),0<r.markers_array.length)for(var t in $(".scale-blue").removeClass("highlight"),o=[],s=null,r.markers_array)if(Math.abs(r.markers_array[t].time-d)<=5)return o=[{id:r.markers_array[t].id,time:r.markers_array[t].time}],void(s=$(".scale-blue[id="+r.markers_array[t].id+"]").addClass("highlight"))}).on("mouseup.dragitem",function(e){$(document).off("mousemove.dragitem"),$(document).off("mouseup.dragitem"),r.maskShow(!1),c.addClass("hidden"),u.removeClass("highlight");var t,i,n,a=u.find(".item-lesson");if(a.length<=0)return c.addClass("hidden"),u.removeClass("highlight"),void m.remove();0<o.length?(n=s.find('[data-role="scale-blue-list"]'),a.appendTo(n).find('[data-role="sqe-number"]').text(n.children().length),r._addScale(s,o[0].time,n.children().length,r.markers_array),s.removeClass("highlight"),r.newSortList(n)):(n=(i=(t=$('[data-role="scale-blue"]')).clone().css("left",l).removeAttr("data-role")).find('[data-role="scale-blue-list"]'),i.find('[data-role="scale-blue-time"]').text(f.i(d)),n.children().remove(),n.append(a),t.after(i),r._addScale(i,d,1,r.markers_array))})}},{key:"itemRmove",value:function(e){e.stopPropagation();var t=$(e.currentTarget),i=t.closest('[data-role="scale-blue-list"]'),e=t.closest("li"),t=t.closest(".scale-blue");this._deleteScale(t,e,i.children().length,this.markers_array)}},{key:"stopEvent",value:function(e){e.stopPropagation()}},{key:"slideScale",value:function(e){var i,n=this,a=[],r=null,o=null,s=$(e.currentTarget),l=$("#editbox-lesson-list");s.css("left");n.maskShow(!0),$(".marker-manage").addClass("slideing"),s.addClass("moveing"),$(document).on("mousemove.slide",function(e){if(window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),i=e.pageX>l.width()+20?l.width()+20:e.pageX&&e.pageX<=20?20:e.pageX,o=Math.round((i-20)*n._video_time/l.width()),s.css("left",i),s.find('[data-role="scale-blue-time"]').text(f.i(o)),0<n.markers_array.length)for(var t in $(".scale-blue").removeClass("highlight"),a=[],r=null,n.markers_array)if(Math.abs(n.markers_array[t].time-o)<=5&&s.attr("id")!=n.markers_array[t].id)return a=[{id:n.markers_array[t].id,time:n.markers_array[t].time}],void(r=$(".scale-blue[id="+n.markers_array[t].id+"]").addClass("highlight"))}).on("mouseup.slide",function(e){var t;$(document).off("mousemove.slide"),$(document).off("mouseup.slide"),n.maskShow(!1),s.removeClass("moveing"),$(".marker-manage").removeClass("slideing"),0<a.length?((t=r.find('[data-role="scale-blue-list"]')).append(s.find('[data-role="scale-blue-list"]').children()),n.sortList(t),r.removeClass("highlight"),n._mergeScale(s,r,n.markers_array)):n._updateScale(s,o)})}},{key:"hoverScale",value:function(e){e=$(e.currentTarget);e.offset().left-20<110?e.find(".scale-details").css("margin-left","-"+(e.offset().left-20)+"px"):e.find(".scale-details").css("margin-left","-110px")}},{key:"previewMouseDown",value:function(e){e.stopPropagation()}},{key:"_addScale",value:function(e,t,i,n){var a=e.find("li:last"),a={id:e.attr("id"),second:t,questionMarkers:[{id:a.attr("id"),seq:i,questionId:a.attr("question-id")}]};$.extend(this.addScale(a,e,n))}},{key:"_mergeScale",value:function(e,t,i){var n={id:e.attr("id"),merg_id:t.attr("id")};$.extend(this.mergeScale(n,e,t,i))}},{key:"_updateScale",value:function(e,t){t={id:e.attr("id"),second:t};$.extend(this.updateScale(t,e))}},{key:"_deleteScale",value:function(e,t,i,n){console.log("id",e,e.attr("id"));var a={id:e.attr("id"),questionMarkers:[{id:t.attr("id"),seq:t.find('[data-role="sqe-number"]').html(),questionId:t.attr("question-id")}]};$.extend(this.deleteScale(a,e,t,i,n))}},{key:"_updateSeq",value:function(e,t){$.extend(this.updateSeq(e,t))}}]),m}(),t=i(63),o=i.n(t),l=i(88);new(function(){function t(e){h()(this,t),this.$form=$(e.formSelect),this.$marker=$(e.markerSelect),this.questionBankSelector=$("#mark-form-bankId"),this.questionCategorySelector=$("#mark-form-categoryId"),this.init()}return n()(t,[{key:"init",value:function(){this.initData(),this.initEvent(),this.initQuestionBankSelector(),this.disableQuestionCategorySelector()}},{key:"initData",value:function(){var t=this,i=0<r()((document.body.clientHeight-350)/50)?r()((document.body.clientHeight-350)/50):1;$.post(this.$form.attr("action"),this.$form.serialize()+"&pageSize="+i,function(e){$("#subject-lesson-list").html(e),$('[data-toggle="popover"]').popover(),o.a.get("MARK-MANGE-GUIDE")?(t.initDrag(),$("#step-1").removeClass("introhelp-icon-help")):t.initIntro(),o.a.set("MARK-MANGE-GUIDE","true",{expires:360,path:"/"}),t.$form.data("pageSize",i)})}},{key:"initIntro",value:function(){$(".js-introhelp-overlay").removeClass("hidden"),$(".show-introhelp").addClass("show");var e=$(".js-introhelp-img img"),t=document.createElement("img"),i=$(window).height()-e.offset().top-80;t.src=e.attr("src");t=i*t.width/t.height/2+50;e.height(i),$(".js-introhelp-img").css("margin-left","-"+t+"px")}},{key:"initEvent",value:function(){var t=this;this.$marker.on("click",".js-question-preview",function(e){return t.onQuestionPreview(e)}),this.$marker.on("click",".js-more-questions",function(e){return t.onMoreQuestion(e)}),this.$marker.on("click",".js-close-introhelp",function(e){return t.onCloseHelp(e)}),this.$marker.on("click","#mark-form-submit",function(e){return t.onFormSubmit(e)}),this.$marker.on("change","#mark-form-bankId",function(e){return t.onChangeSelect(e)}),this.$marker.on("change","#mark-form-categoryId",function(e){return t.onChangeSelect(e)}),this.$marker.on("keydown","#mark-form-keyword",function(e){return t.onFormAutoSubmit(e)})}},{key:"initQuestionBankSelector",value:function(){this.questionBankSelector.select2({treeview:!0,dropdownAutoWidth:!0,treeviewInitState:"collapsed",placeholderOption:"first",formatResult:function(e){var t=Object(l.b)(e.text);return e.id?'<div class="select2-result-text"><span class="select2-match"></span><span><i class="es-icon es-icon-tiku"></i>'.concat(t,"</span></div>"):t},dropdownCss:{width:""}})}},{key:"disableQuestionCategorySelector",value:function(){this.questionCategorySelector.select2({disable:!0})}},{key:"enableQuestionCategorySelector",value:function(){this.questionCategorySelector.select2({treeview:!0,dropdownAutoWidth:!0,treeviewInitState:"collapsed",placeholderOption:"first"})}},{key:"onFormAutoSubmit",value:function(e){13===e.keyCode&&(e.preventDefault(),this.onFormSubmit(e))}},{key:"onFormSubmit",value:function(e){if(this.$form.validate().form()){var t=this.$form.data("pageSize");$.post(this.$form.attr("action"),this.$form.serialize()+"&pageSize="+t,function(e){$("#subject-lesson-list").html(e)});t=$(e.target),e=t.data("url");if(void 0!==e){var i=$("#mark-form-categoryId"),n='<option value="0">'.concat(Translator.trans("question.marker_question.select_question_category"),"</option>"),t=t.val();if(!r()(t))return i.html(n),void this.disableQuestionCategorySelector();var a=this;$.post(e,{bankId:t},function(e){n+='<option value="0">无</option>',$.each(e,function(e,t){var i=1<t.depth?"　".repeat(t.depth-1):"";n+='<option value="'.concat(t.id,'">').concat(i).concat(t.name,"</option>")}),i.html(n),a.enableQuestionCategorySelector()})}}}},{key:"onChangeSelect",value:function(e){this.onFormSubmit(e)}},{key:"onQuestionPreview",value:function(e){$.get($(e.currentTarget).data("url"),function(e){$(".modal").modal("show").html(e)})}},{key:"onMoreQuestion",value:function(e){var t=$(e.currentTarget).hide().parent().addClass("loading"),i=$("#subject-lesson-list").css("max-height",$("#subject-lesson-list").height()),n=r()(t.data("current-page"))+1,a=r()(t.data("last-page")),e={bankId:$("select[name=bankId]").val(),categoryId:$("select[name=categoryId]").val(),keyword:$("[name=keyword]").val(),pageSize:this.$form.data("pageSize")};$.post(t.data("url")+n,e,function(e){t.remove(),i.append(e).animate({scrollTop:40*(i.find(".item-lesson").length+1)}),n===a&&$(".js-more-questions").parent().remove()})}},{key:"onCloseHelp",value:function(e){$(e.currentTarget).closest(".show-introhelp").removeClass("show-introhelp"),$(".show-introhelp").length<=0&&($(".js-introhelp-overlay").addClass("hidden"),this.initDrag())}},{key:"initDrag",value:function(){var o,t=[],i=30;$.ajax({type:"get",url:$(".js-pane-question-content").data("marker-metas-url"),cache:!1,async:!1,success:function(e){t=e.markersMeta,i=e.videoTime}}),o=new s({element:"#task-dashboard",initMarkerArry:t,_video_time:i,messenger:a,addScale:function(t,i,n){var e=$(".js-pane-question-content").data("queston-marker-add-url"),a={markerId:t.id,second:t.second,questionId:t.questionMarkers[0].questionId,seq:t.questionMarkers[0].seq};return $.post(e,a,function(e){void 0!==e.id&&(void 0===t.id&&(i.attr("id",e.markerId),n.push({id:e.markerId,time:t.second})),i.removeClass("hidden"),i.find(".item-lesson[question-id="+t.questionMarkers[0].questionId+"]").attr("id",e.id))}),t},mergeScale:function(i,n,e,a){var t=$(".js-pane-question-content").data("marker-merge-url");return $.post(t,{sourceMarkerId:i.id,targetMarkerId:i.merg_id},function(e){for(var t in n.remove(),a)if(a[t].id==i.id){a.splice(t,1);break}}),i},updateScale:function(e){var t=$(".js-pane-question-content").data("marker-update-url"),i={id:e.id,second:e.second};return e.second?$.post(t,i,function(e){}):console.log("do not need upgrade scale..."),e},deleteScale:function(i,n,a,e,r){var t=$(".js-pane-question-content").data("queston-marker-delete-url");$.post(t,{questionId:i.questionMarkers[0].id},function(e){if(a.remove(),console.log(i.questionMarkers[0].questionId,"questionId"),$("#subject-lesson-list").find(".item-lesson[question-id="+i.questionMarkers[0].questionId+"]").removeClass("disdragg").addClass("drag"),n.find('[data-role="scale-blue-list"]').children().length<=0){for(var t in n.remove(),r)if(r[t].id==n.attr("id")){r.splice(t,1);break}}else console.log("drag",o),o.sortList(n.find('[data-role="scale-blue-list"]'))})},updateSeq:function(e,t){if(void 0!==t&&void 0!==t.questionMarkers&&0!==t.questionMarkers.length){for(var i=$(".js-pane-question-content").data("queston-marker-sort-url"),n=[],a=0;a<t.questionMarkers.length;a++)n.push(t.questionMarkers[a].id);$.post(i,{questionIds:n})}}})}}]),t}())({formSelect:".js-mark-form",markerSelect:".js-marker-manage-content"})}});