!function(u){function t(t){for(var e,i,n=t[0],s=t[1],a=t[2],o=0,r=[];o<n.length;o++)i=n[o],Object.prototype.hasOwnProperty.call(l,i)&&l[i]&&r.push(l[i][0]),l[i]=0;for(e in s)Object.prototype.hasOwnProperty.call(s,e)&&(u[e]=s[e]);for(h&&h(t);r.length;)r.shift()();return d.push.apply(d,a||[]),c()}function c(){for(var t,e=0;e<d.length;e++){for(var i=d[e],n=!0,s=1;s<i.length;s++){var a=i[s];0!==l[a]&&(n=!1)}n&&(d.splice(e--,1),t=o(o.s=i[0]))}return t}var i={},l={284:0},d=[];function o(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return u[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}o.m=u,o.c=i,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/static-dist/";var e=window.webpackJsonp=window.webpackJsonp||[],n=e.push.bind(e);e.push=t,e=e.slice();for(var s=0;s<e.length;s++)t(e[s]);var h=n;d.push([719,0]),c()}({152:function(t,e,i){t.exports=i(301)},17:function(t,e){t.exports=jQuery},248:function(t,e,i){i(249);var n=i(27).Object;t.exports=function(t,e){return n.getOwnPropertyDescriptor(t,e)}},249:function(t,e,i){var n=i(93),s=i(137).f;i(263)("getOwnPropertyDescriptor",function(){return function(t,e){return s(n(t),e)}})},291:function(n,t,e){var s=e(45),a=e(694),o=e(697);function r(t,e,i){return"undefined"!=typeof Reflect&&a?n.exports=r=a:n.exports=r=function(t,e,i){t=o(t,e);if(t){e=s(t,e);return e.get?e.get.call(i):e.value}},r(t,e,i||t)}n.exports=r},301:function(t,e,i){i(287),i(266),t.exports=i(302)},302:function(t,e,i){var n=i(86),s=i(299);t.exports=i(27).getIterator=function(t){var e=s(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},45:function(t,e,i){t.exports=i(248)},694:function(t,e,i){t.exports=i(695)},695:function(t,e,i){i(696),t.exports=i(27).Reflect.get},696:function(t,e,i){var a=i(137),o=i(341),r=i(254),n=i(48),u=i(140),c=i(86);n(n.S,"Reflect",{get:function t(e,i){var n,s=arguments.length<3?e:arguments[2];return c(e)===s?e[i]:(n=a.f(e,i))?r(n,"value")?n.value:void 0!==n.get?n.get.call(s):void 0:u(n=o(e))?t(n,i,s):void 0}})},697:function(t,e,i){var n=i(5);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}},719:function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return U});var e=i(152),r=i.n(e),e=i(252),u=i.n(e),e=i(251),c=i.n(e),e=i(150),l=i.n(e),e=i(151),d=i.n(e),e=i(18),o=i.n(e),e=i(12),h=i.n(e),e=i(28),s=i.n(e),e=i(6),a=i.n(e),e=i(0),f=i.n(e),e=i(1),m=i.n(e),p=i(16),n=function(){function t(){f()(this,t),this.questions={},this.eventManager={},this.tokenList=[],this.$itemList=$(".js-item-list"),this.questionCounts={},this.totalScore=0,this.flag=!0,this.init()}return m()(t,[{key:"init",value:function(){this.initQuestions(),this.initQuestionCountsAndTotalScore(),this.flag=!1}},{key:"initQuestions",value:function(){for(var s=this,a=this._toJson($(".js-cached-data").text()),t=0;t<a.length;t++)!function(t){var i=s._getToken(),e=a[t];e.categoryId=0,s.questions[i]=e,s.tokenList.push(i);$('[data-anchor="#'.concat(t,'"]')).attr("data-anchor","#".concat(i));var n=$("#".concat(t)).attr("id",i);"material"===e.type&&$.each(e.subQuestions,function(t,e){n=n.next('[data-key="'.concat(t,'"]')).attr("data-material-token",i)})}(t)}},{key:"initQuestionCountsAndTotalScore",value:function(){this.questionCounts={total:0,single_choice:0,choice:0,uncertain_choice:0,determine:0,fill:0,essay:0,material:0};var i=this;s()(this.questions).forEach(function(t){t=i.questions[t];i.questionCounts.total++,i.questionCounts[t.type]++,"material"!==t.type?i.totalScore=(h()(i.totalScore)+h()(t.score)).toFixed(1):$.each(t.subQuestions,function(t,e){i.totalScore=(h()(i.totalScore)+h()(e.score)).toFixed(1)})})}},{key:"getQuestionCount",value:function(t){return this.questionCounts[t]}},{key:"getTotalScore",value:function(){return this.totalScore}},{key:"getQuestionOrder",value:function(t){return this.tokenList.indexOf(t)+1}},{key:"getTokenList",value:function(){return this.tokenList}},{key:"modifyDifficulty",value:function(t,i,n){var s=this;$.each(t,function(t,e){void 0!==s.questions[e]&&(s.updateQuestionItem(e,"difficulty",i),s.$itemList.find("#".concat(e)).find(".js-difficulty").html(n))})}},{key:"modifyScore",value:function(t,n,s){var a=this;$.each(t,function(t,e){a.$itemList.find("#".concat(e)).find(".js-score").html("".concat(n.score).concat(Translator.trans("subject.question_score_unit")));var i=a.getQuestion(e);a.updateQuestionItem(e,"score",n.score,!1),s&&("choice"!==i.type&&"uncertain_choice"!==i.type||a.updateQuestionItem(e,"missScore",n.missScore))}),a.trigger("updateQuestionScore")}},{key:"modifyCategory",value:function(t,i,n){var s=this;$.each(t,function(t,e){void 0!==s.questions[e]&&(s.updateQuestionItem(e,"categoryId",i),s.$itemList.find("#".concat(e)).find(".js-category").html(Object(p.h)(n,8)),s.$itemList.find("#".concat(e)).find(".js-category").attr("data-original-title",n))})}},{key:"addQuestion",value:function(t,e){if(this.isUpdating()){this.flag=!0,"material"===e.type&&(e.subQuestions=[],e.score=0);var i=this._getToken();this.questions[i]=e;t=this.tokenList.indexOf(t)+1;this.tokenList.splice(t,0,i),this.questionCounts.total++,this.questionCounts[e.type]++,this.totalScore=(h()(this.totalScore)+h()(e.score)).toFixed(1);t=t+1;return this.trigger("addQuestion",[t,i,e.type]),this.flag=!1,i}}},{key:"deleteQuestion",value:function(t){var e,i;this.isUpdating()&&(this.flag=!0,e=this.questions[t],delete this.questions[t],t=this.tokenList.indexOf(t),this.tokenList.splice(t,1),this.questionCounts.total--,this.questionCounts[e.type]--,"material"!==e.type?this.totalScore=(h()(this.totalScore)-h()(e.score)).toFixed(1):(i=this,$.each(e.subQuestions,function(t,e){i.totalScore=(h()(i.totalScore)-h()(e.score)).toFixed(1)})),this.trigger("deleteQuestion",[e.type]),this.flag=!1)}},{key:"updateQuestionItem",value:function(t,e,i,n){var s=!(3<arguments.length&&void 0!==n)||n;this.isUpdating()&&(this.flag=!0,n=this.questions[t][e],this.questions[t][e]=i,"score"===e&&(this.totalScore=(this.totalScore-h()(n)+h()(i)).toFixed(1),this.trigger("updateQuestionScore",[s])),"type"===e&&n!=i&&(this.questionCounts[n]--,this.questionCounts[i]++,this.trigger("updateQuestionType",[e,i,n,t])),this.flag=!1)}},{key:"getQuestion",value:function(t){if(this.isUpdating())return this.questions[t]}},{key:"getQuestions",value:function(){return this.questions}},{key:"getSubQuestion",value:function(t,e){if(this.isUpdating())return this.questions[t].subQuestions[e]}},{key:"addSubQuestion",value:function(t,e){if(this.isUpdating())return this.flag=!0,this.questions[t].subQuestions.push(e),this.totalScore=(h()(this.totalScore)+h()(e.score)).toFixed(1),this.trigger("updateQuestionScore"),this.flag=!1,t}},{key:"updateSubQuestionItem",value:function(t,e,i,n,s){var a=!(4<arguments.length&&void 0!==s)||s;this.isUpdating()&&(this.flag=!0,s=this.questions[t].subQuestions[e][i],this.questions[t].subQuestions[e][i]=n,"score"==i&&(this.totalScore=(this.totalScore-h()(s)+h()(n)).toFixed(1),this.trigger("updateQuestionScore",[a])),this.flag=!1)}},{key:"deleteSubQuestion",value:function(t,e){var i;this.isUpdating()&&(this.flag=!0,i=this.questions[t].subQuestions[e],this.questions[t].subQuestions.splice(e,1),this.totalScore=(h()(this.totalScore)-h()(i.score)).toFixed(1),this.correctMaterialQuestion(t),this.trigger("updateQuestionScore"),this.flag=!1)}},{key:"correctQuestion",value:function(t){var e=this.questions[t];void 0!==e.errors&&("material"===e.type&&void 0!==e.errors.hasSubError?e.errors={hasSubError:!0}:delete e.errors,void 0===(this.questions[t]=e).errors&&this.trigger("correctQuestion",[t]))}},{key:"correctSubQuestion",value:function(t,e){var i=this.questions[t],n=i.subQuestions[e];void 0!==n.errors&&(delete n.errors,i.subQuestions[e]=n,this.questions[t]=i,this.correctMaterialQuestion(t))}},{key:"correctMaterialQuestion",value:function(t){var e=this.questions[t],i=!1;$.each(e.subQuestions,function(t,e){void 0!==e.errors&&(i=!0)}),i||void 0===e.errors||delete e.errors.hasSubError,$.isEmptyObject(e.errors)&&(delete e.errors,this.trigger("correctQuestion",[t])),this.questions[t]=e}},{key:"isUpdating",value:function(){return!0!==this.flag||(cd.message({type:"danger",message:Translator.trans("course.question.is_updating_hint")}),!1)}},{key:"_toJson",value:function(t){var e={};return t&&(e=$.parseJSON(t.replace(/[\r\n\t]/g,""))),e}},{key:"on",value:function(t,e){this.eventManager[t]?this.eventManager[t].push(e.bind(this)):this.eventManager[t]=[e.bind(this)]}},{key:"trigger",value:function(t,e){this.eventManager[t]&&this.eventManager[t].map(function(t){t.apply(null,e)})}},{key:"_random",value:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)}},{key:"_getToken",value:function(){return this._random()+this._random()+"-"+this._random()+"-"+this._random()+"-"+this._random()+"-"+this._random()+this._random()+this._random()}}]),t}(),v=i(90),g=function(){function i(t,e){f()(this,i),this.$form=t,this.operate=e,this.titleFieldId="question-stem-field",this.$analysisModal=$(".js-analysis-modal"),this.validator=null,this.titleEditorToolBarName="Minimal",this.analysisEditor=null,this._init(),this.attachmentActions=new v.a(t)}return m()(i,[{key:"_init",value:function(){this._initEvent(),this._initValidate(),this._initAnalysisEditor(),this._initSelect()}},{key:"_initEvent",value:function(){var e=this;this.$form.on("click",".js-finish-edit",function(t){return e.submitForm(t)}),this.$form.on("click",".js-analysis-edit",function(t){return e.showAnalysisModal(t)}),this.$analysisModal.on("click",".js-analysis-btn",function(t){return e.saveAnalysis(t)}),$('[data-toggle="tooltip"]').tooltip()}},{key:"_initSelect",value:function(){$("[name=categoryId]").select2({treeview:!0,dropdownAutoWidth:!0,treeviewInitState:"collapsed",placeholderOption:"first"})}},{key:"_initTooltip",value:function(){$("[data-toggle=tooltip]").tooltip()}},{key:"submitForm",value:function(t){this.validator.form()&&($(t.currentTarget).button("loading"),t=this.getQuestion(),this.finishEdit(t),this.changeBottomFixed())}},{key:"changeBottomFixed",value:function(){var t=a()(window.scrollY+document.documentElement.clientHeight),e=0;$(".es-footer-link").length?e=a()($(".es-footer-link").offset().top):$(".es-footer").length&&(e=a()($(".es-footer").offset().top)),e?e<t&&$(".js-subject-item-btn").removeClass("subject-bottom-fixed"):(t=a()($(document).scrollTop()),a()($(document.body).height())-560<=t+a()($(window).height())&&$(".js-subject-item-btn").removeClass("subject-bottom-fixed"))}},{key:"_initAnalysisEditor",value:function(){var t=this,e=this.$form.find('[data-edit="analysis"]').val(),i=$(".js-analysis-field");CKEDITOR.instances[i.attr("id")]&&CKEDITOR.instances[i.attr("id")].destroy(),i.val(e),this.analysisEditor=CKEDITOR.replace(i.attr("id"),{toolbar:this.titleEditorToolBarName,fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:i.data("imageUploadUrl"),height:i.height()}),this.analysisEditor.on("change",function(){i.val(t.analysisEditor.getData())}),this.analysisEditor.on("blur",function(){i.val(t.analysisEditor.getData())})}},{key:"showAnalysisModal",value:function(t){t=$(t.currentTarget).prev('[data-edit="analysis"]').val();this.analysisEditor.setData(t),this.$analysisModal.modal("show")}},{key:"saveAnalysis",value:function(){var t=this.analysisEditor.getData();$('[data-edit="analysis"]').val(t),$(".js-analysis-content").html($(this.replacePicture(t)).text()),this.$analysisModal.modal("hide")}},{key:"finishEdit",value:function(t){var e=this,i=$(".js-hidden-token").val(),n=$(".js-hidden-method").val(),s=$(".js-sub-judge").val(),a=$(".js-edit-form-seq").text()-1,o=0,o="1"==s?(i=e.updateCachedSubQuestion(i,a,t,n),t=e.operate.getSubQuestion(i,a),1+a):(i=e.updateCachedQuestion(i,t,n),t=e.operate.getQuestion(i),e.operate.getQuestionOrder(i));this.analysisEditor.destroy(),$.post(e.$form.data("url"),{seq:o,question:t,token:i,isSub:s},function(t){e.$form.parent(".subject-item").replaceWith(t),e._initTooltip()})}},{key:"updateCachedQuestion",value:function(i,t,e){var n=this;return"add"==e?i=n.operate.addQuestion(i,t):($.each(t,function(t,e){n.operate.updateQuestionItem(i,t,e)}),n.operate.correctQuestion(i)),i}},{key:"updateCachedSubQuestion",value:function(i,n,t,e){var s=this;return"add"==e?i=s.operate.addSubQuestion(i,t):($.each(t,function(t,e){s.operate.updateSubQuestionItem(i,n,t,e)}),s.operate.correctSubQuestion(i,n)),i}},{key:"getQuestion",value:function(){var i={};return $("*[data-edit]").each(function(){var t=$(this).data("edit"),e=$(this).val();i[t]=e}),i.difficulty=$("input[name='difficulty']:checked").val(),i.attachment=this.getAttachments(),i=this.filterQuestion(i)}},{key:"filterQuestion",value:function(t){return t}},{key:"getAttachments",value:function(){var t={};return 0<$(".js-attachment-list-stem").find(".js-attachment-name").length&&(t.stem={type:"attachment",targetType:"question.stem",fileIds:$(".js-attachment-ids-stem").val(),fileName:$(".js-attachment-list-stem").find(".js-attachment-name").text()}),0<$(".js-attachment-list-analysis").find(".js-attachment-name").length&&(t.analysis={type:"attachment",targetType:"question.analysis",fileIds:$(".js-attachment-ids-analysis").val(),fileName:$(".js-attachment-list-analysis").find(".js-attachment-name").text()}),t}},{key:"_initValidate",value:function(){var t=this.$form.validate({onkeyup:!1,rules:{difficulty:{required:!0},stem:{required:!0},score:{required:!0,number:!0,max:999,min:0,es_score:!0}},messages:{difficulty:Translator.trans("course.question.create.difficulty_required_error_hint"),stem:{required:Translator.trans("subject.stem_required")}}});this.validator=t}},{key:"initTitleEditor",value:function(){var t=this,e=$("#"+t.titleFieldId),i=e.prev(),n=CKEDITOR.replace(t.titleFieldId,{toolbar:t.titleEditorToolBarName,fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:e.data("imageUploadUrl"),height:e.height()});n.on("change",function(){e.val(n.getData()),i.val($(t.replacePicture(n.getData())).text())}),n.on("blur",function(){e.val(n.getData()),i.val($(t.replacePicture(n.getData())).text())}),n.on("instanceReady",function(){this.focus(),$('[data-role="edit"]').one("click",function(){i.val($(t.replacePicture(n.getData())).text()),e.val(n.getData()),n.destroy(),e.hide(),i.show()})})}},{key:"replacePicture",value:function(t){return t.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/gi,"[".concat(Translator.trans("subject.symbol.picture"),"]"))}},{key:"titleEditorToolBarName",set:function(t){this._titleEditorToolBarName=t},get:function(){return this._titleEditorToolBarName}}]),i}(),e=i(2),y=i.n(e),e=i(8),b=i.n(e),e=i(9),k=i.n(e),e=i(5),j=i.n(e);function T(i){var n=function(){if("undefined"==typeof Reflect||!y.a)return!1;if(y.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(y()(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=j()(i);return e=n?(t=j()(this).constructor,y()(e,arguments,t)):e.apply(this,arguments),k()(this,e)}}var _=function(t){b()(n,t);var i=T(n);function n(t,e){return f()(this,n),(e=i.call(this,t,e)).validator=null,e.oldFieldId="question-stem-field",e.fieldId="",e.optionCount=0,e.timer=!1,e.errorMessage={noAnswer:Translator.trans("subject.choice_answer_least_two")},e.init(),e}return m()(n,[{key:"init",value:function(){this.initTitleEditor(this.validator),this.initOptionCount(),this.initData(),this.initEvent(),this.initValidator()}},{key:"initOptionCount",value:function(){this.optionCount=$(".edit-subject-item").length}},{key:"initEvent",value:function(){var e=this;this.$form.on("focus",".js-item-option-edit",function(t){return e.editOption(t)}),this.$form.on("click",".js-item-option-delete",function(t){return e.deleteOption(t)}),this.$form.on("click",".js-item-option-add",function(t){return e.addOption(t)}),this.$form.on("click",'[data-role="edit"]',function(t){return e.editOption(t)})}},{key:"initData",value:function(){$(".cd-checkbox.checked").find('[name="right"]').attr("checked",!0)}},{key:"initValidator",value:function(){$.validator&&($.validator.prototype.elements=function(){var t=this,e={};return $(this.currentForm).find("input, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&t.settings.debug&&window.console&&console.error("%o has no name assigned",this),e[this.name]=!0})},$.validator.addMethod("noMoreThan",function(t,e,i){return""==t||h()(t)<=h()($(i).val())},"Please enter a lesser value."),$.validator.addMethod("multi",function(t,e,i){return 1<$('input:checkbox[name="right"]:checked').length}));var n=this;this.$form.validate().destroy(),this.validator=this.$form.validate({onkeyup:!1,rules:{score:{required:!0,max:999,min:0,es_score:!0},missScore:{required:!1,max:999,min:0,noMoreThan:'[name="score"]',es_score:!0},stem:{required:!0},options:{required:!0},right:{required:!0,multi:!0}},messages:{missScore:{noMoreThan:Translator.trans("subject.miss_score_no_more_than_score")},stem:{required:Translator.trans("subject.validate.stem_required")},options:{required:Translator.trans("subject.validate.option_required")}},errorPlacement:function(t,e){var i=e.attr("name");"right"==i?($(".edit-subject-item__order").addClass("edit-subject-item__order--error"),cd.message({type:"danger",message:n.errorMessage.noAnswer})):"stem"==i?$("#cke_question-stem-field").after(t):"options"==i&&e.prev().hasClass("hidden")?t.appendTo(e.parent()):t.insertAfter(e)}})}},{key:"editOption",value:function(t){var e=this,i=$(t.currentTarget),t=i.next();this.fieldId=t.attr("id"),i.addClass("hidden");var n=$("#"+this.fieldId),s=null;CKEDITOR.instances[this.oldFieldId]&&(s=CKEDITOR.instances[this.oldFieldId],(i=$("#"+this.oldFieldId)).addClass("hidden"),i.prevAll("input").first().removeClass("hidden").show().val($(e.replacePicture(s.getData())).text()),CKEDITOR.instances[this.oldFieldId].destroy()),this.oldFieldId=this.fieldId,CKEDITOR.instances[this.fieldId]&&CKEDITOR.instances[this.fieldId].destroy(),(s=CKEDITOR.replace(this.fieldId,{toolbar:"Minimal",fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:n.data("imageUploadUrl"),height:n.height(),startupFocus:!0})).focus(),s.on("change",function(){n.val(s.getData()),n.prev("input").val($(e.replacePicture(s.getData())).text())}),s.on("blur",function(){n.val(s.getData()),n.prev("input").val($(e.replacePicture(s.getData())).text())})}},{key:"deleteOption",value:function(t){var i,n;this.optionCount<=2?cd.message({type:"danger",message:Translator.trans("subject.choice_option_least_two")}):(t=$(t.currentTarget).parents(".edit-subject-item"),i=t.find(".edit-subject-item__order").text(),n=t.find('input[name="right"]').val(),t.nextAll(".edit-subject-item").each(function(){var t=$(this).find(".edit-subject-item__order"),e=t.text();t.text(i),i=e,$(this).find('input[name="right"]').val(n),n++}),t.remove(),this.optionCount--)}},{key:"addOption",value:function(t){var e=this;e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){e.addRealOperate(t)},500)}},{key:"addRealOperate",value:function(e){var i=this,t=$(e.currentTarget);if(10<=this.optionCount)return cd.message({type:"danger",message:Translator.trans("subject.choice_option_most_ten")}),void t.attr("disabled",!1);t=$('[name="type"]').val();$.ajax({url:"/subject/option/".concat(t),type:"get",data:{order:this.optionCount}}).done(function(t){$(e.currentTarget).parent().before(t),i.optionCount++})}},{key:"submitForm",value:function(t){this.optionCount<2?cd.message({type:"danger",message:Translator.trans("subject.choice_option_least_two")}):(this.validator.resetForm(),this.validator.form()&&($(t.currentTarget).button("loading"),this.finishEdit(this.$form.serializeArray())))}},{key:"finishEdit",value:function(t){var e=$(".js-hidden-token").val(),i=this,n={options:[],answers:[]};$.each(t,function(t,e){var i=e.name,e=e.value;-1!==$.inArray(i,["stem","difficulty","score","missScore","type","analysis","categoryId"])?n[i]=e:"options"==i?n.options.push(e):"right"==i&&n.answers.push(e)}),n.attachment=this.getAttachments();var s=$(".js-hidden-method").val(),a=$(".js-sub-judge").val(),o=$(".js-edit-form-seq").text()-1,t=0,t="1"==a?(e=i.updateCachedSubQuestion(e,o,n,s),n=i.operate.getSubQuestion(e,o),1+o):(e=i.updateCachedQuestion(e,n,s),n=i.operate.getQuestion(e),i.operate.getQuestionOrder(e));this.analysisEditor.destroy(),$.post(i.$form.data("url"),{seq:t,question:n,token:e,isSub:a},function(t){i.$form.parent(".subject-item").replaceWith(t),i._initTooltip()})}}]),n}(g),e=i(291),q=i.n(e);function x(i){var n=function(){if("undefined"==typeof Reflect||!y.a)return!1;if(y.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(y()(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=j()(i);return e=n?(t=j()(this).constructor,y()(e,arguments,t)):e.apply(this,arguments),k()(this,e)}}var w=function(t){b()(n,t);var i=x(n);function n(t,e){return f()(this,n),(e=i.call(this,t,e)).errorMessage={noAnswer:Translator.trans("subject.choice_require_answer")},e}return m()(n,[{key:"initEvent",value:function(){var e=this;q()(j()(n.prototype),"initEvent",this).call(this),this.$form.on("change",'input:radio[name="right"]',function(t){return e.changeRadio(t)})}},{key:"initData",value:function(){q()(j()(n.prototype),"initData",this).call(this);var t=this.$form.find(".js-choose-item");$(".cd-radio.checked").find('[name="right"]').attr("checked",!0),this.checkedRadio=t.find(".cd-radio.checked")}},{key:"initValidator",value:function(){q()(j()(n.prototype),"initValidator",this).call(this),$.validator.addMethod("multi",function(t,e,i){return!0})}},{key:"changeRadio",value:function(t){this.checkedRadio&&this.checkedRadio.removeClass("checked"),this.checkedRadio=$(t.currentTarget).parent()}}]),n}(_);function S(i){var n=function(){if("undefined"==typeof Reflect||!y.a)return!1;if(y.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(y()(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=j()(i);return e=n?(t=j()(this).constructor,y()(e,arguments,t)):e.apply(this,arguments),k()(this,e)}}var Q=function(t){b()(n,t);var i=S(n);function n(t,e){return f()(this,n),(e=i.call(this,t,e)).errorMessage={noAnswer:Translator.trans("subject.choice_require_answer")},e}return m()(n,[{key:"initValidator",value:function(){q()(j()(n.prototype),"initValidator",this).call(this),$.validator.addMethod("multi",function(t,e,i){return!0})}}]),n}(_);function C(i){var n=function(){if("undefined"==typeof Reflect||!y.a)return!1;if(y.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(y()(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=j()(i);return e=n?(t=j()(this).constructor,y()(e,arguments,t)):e.apply(this,arguments),k()(this,e)}}var O=function(t){b()(n,t);var i=C(n);function n(t,e){return f()(this,n),(e=i.call(this,t,e)).initTitleEditor(e.validator),e.$answerField=$('[name="answer"]'),e.init(),e}return m()(n,[{key:"init",value:function(){this.$answerField.rules("add",{required:!0,messages:{required:Translator.trans("course.question.create.right_answer_required_error_hint")}})}},{key:"filterQuestion",value:function(t){var e=$("input[name='answer']:checked").val();return t.answer="true"==e,t}}]),n}(g);function I(i){var n=function(){if("undefined"==typeof Reflect||!y.a)return!1;if(y.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(y()(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=j()(i);return e=n?(t=j()(this).constructor,y()(e,arguments,t)):e.apply(this,arguments),k()(this,e)}}jQuery.validator.addMethod("fillCheck",function(t,e){return this.optional(e)||/(\[\[(.+?)\]\])/i.test(t)},Translator.trans("course.question.create.fill_hint"));var E=function(t){b()(n,t);var i=I(n);function n(t,e){return f()(this,n),(e=i.call(this,t,e)).titleEditorToolBarName="Question",e.initTitleEditor(e.validator),e.$titleField=$("#"+e.titleFieldId),e.init(),e}return m()(n,[{key:"init",value:function(){this.$titleField.rules("add",{fillCheck:!0})}},{key:"filterQuestion",value:function(t){var e=t.stem.match(/\[\[(.+?)\]\]/g);if(null!=e){t.answers=[];for(var i=0;i<e.length;i++){var n=(n=e[i].substring(2)).substring(0,n.length-2);t.answers.push(n)}}return t}}]),n}(g);function M(i){var n=function(){if("undefined"==typeof Reflect||!y.a)return!1;if(y.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(y()(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=j()(i);return e=n?(t=j()(this).constructor,y()(e,arguments,t)):e.apply(this,arguments),k()(this,e)}}var D=function(t){b()(n,t);var i=M(n);function n(t,e){return f()(this,n),(e=i.call(this,t,e)).initTitleEditor(e.validator),e.answerFieldId="question-answer-field",e.$answerField=$("#"+e.answerFieldId),e.init(),e}return m()(n,[{key:"init",value:function(){var e=this;this.$answerField.rules("add",{required:!0,messages:{required:Translator.trans("subject.essay_require_answer")}}),this.$form.on("click",'[data-role="edit"]',function(t){return e.answerClick(t)})}},{key:"answerClick",value:function(t){var e=this,i=$(t.currentTarget),n=i.next();i.hide();var s=CKEDITOR.replace(n.attr("id"),{toolbar:"Minimal",fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:n.data("imageUploadUrl"),height:n.height()});s.on("change",function(){n.val(s.getData()),i.val($(e.replacePicture(s.getData())).text())}),s.on("blur",function(){n.val(s.getData()),i.val($(e.replacePicture(s.getData())).text())}),s.on("instanceReady",function(){this.focus(),$('[data-role="edit"]').one("click",function(){i.val($(e.replacePicture(s.getData())).text()),n.val(s.getData()),s.destroy(),n.hide(),i.show()})})}}]),n}(g);function F(i){var n=function(){if("undefined"==typeof Reflect||!y.a)return!1;if(y.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(y()(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=j()(i);return e=n?(t=j()(this).constructor,y()(e,arguments,t)):e.apply(this,arguments),k()(this,e)}}var L=function(t){b()(n,t);var i=F(n);function n(t,e){return f()(this,n),(e=i.call(this,t,e)).initTitleEditor(e.validator),e}return n}(g),B=function(){function t(){f()(this,t)}return m()(t,null,[{key:"getEditor",value:function(t,e,i){switch(t){case"single_choice":new w(e,i);break;case"uncertain_choice":new Q(e,i);break;case"choice":new _(e,i);break;case"determine":new O(e,i);break;case"essay":new D(e,i);break;case"fill":new E(e,i);break;case"material":new L(e,i);break;default:new g(e,i).initTitleEditor()}}}]),t}(),A=i(139);function P(t,e){var i;if(void 0===l.a||null==t[c.a]){if(u()(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return R(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return d()(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return R(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,e=function(){};return{s:e,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){i=r()(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){o=!0,s=t},f:function(){try{a||null==i.return||i.return()}finally{if(o)throw s}}}}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var U=function(){function c(){f()(this,c),this.$element=$(".js-subject-list"),this.$itemList=$(".js-item-list"),this.$subjectData=$(".js-subject-data"),this.$batchBtn=$(".js-batch-btn"),this.$allBtn=$(".js-batch-select"),this.flag=!0,this.$diffiultyModal=$(".js-difficulty-modal"),this.$scoreModal=$(".js-score-modal"),this.$categoryModal=$(".js-category-modal"),this.scoreValidator=null,this.selectQuestion=[],this.questionOperate=null,this.testpaperTitle="",this.redirect=!1,this.questionOperate=null,this.timer=!1,this.questionBankId=$("#questionBankId").val(),this.init()}return m()(c,[{key:"init",value:function(){this.initQuestionOperate(),this.confirmFresh(),this.sbListFixed(),this.footerButtonFixed(),this.initEvent(),this.initScoreValidator(),this.setDifficulty(),this.initTestpaperTitle(),this.itemClick(),this.statErrorQuestions(),this.ieImg(),this.initSelect(),this.initTooltip()}},{key:"initQuestionOperate",value:function(){var s=this;s.questionOperate=new n,s.questionOperate.on("correctQuestion",function(t){$('[data-anchor="#'.concat(t,'"]')).hasClass("subject-list-item__num--error")&&($('[data-anchor="#'.concat(t,'"]')).removeClass("subject-list-item__num--error"),s.statErrorQuestions())}),s.questionOperate.on("addQuestion",function(t,e,i){$('[data-anchor="#'.concat(t,'"]')).attr("data-anchor","#"+e),s.updateTotalScoreText(),s.updateQuestionCountText(i)}),s.questionOperate.on("deleteQuestion",function(t){s.updateTotalScoreText(),s.updateQuestionCountText(t)}),s.questionOperate.on("updateQuestionScore",function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];s.updateTotalScoreText(t)}),s.questionOperate.on("updateQuestionType",function(t,e,i,n){s.updateQuestionCountText(e),s.updateQuestionCountText(i),s.questionTypeConvert(e,n)})}},{key:"initSelect",value:function(){$("[name=categoryId]").select2({treeview:!0,dropdownAutoWidth:!0,treeviewInitState:"collapsed",placeholderOption:"first"})}},{key:"initTooltip",value:function(){$("[data-toggle=tooltip]").tooltip()}},{key:"confirmFresh",value:function(){var t=this;$(window).on("beforeunload",function(){if(!t.redirect)return Translator.trans("admin.block.not_saved_data_hint")})}},{key:"initEvent",value:function(){var e=this;this.$element.on("click",".js-batch-select",function(t){return e.batchToItem(t)}),this.$element.on("click",".js-show-checkbox",function(t){return e.itemToBatch(t)}),this.$element.on("click",".js-batch-btn",function(t){return e.batchBtnClick(t)}),this.$element.on("click",".js-finish-btn",function(t){return e.finishBtnClick(t)}),this.$element.on("click","*[data-anchor]",function(t){return e.quickToQuestion(t,e.flag)}),this.$element.on("click",".js-difficult-setting",function(t){return e.showModal(t,e.$diffiultyModal)}),this.$element.on("click",".js-category-setting",function(t){return e.showModal(t,e.$categoryModal)}),this.$element.on("click",".js-score-setting",function(t){return e.showScoreModal(t)}),this.$scoreModal.on("click",".js-batch-score-confirm",function(t){return e.batchSetScore(t)}),this.$categoryModal.on("click",".js-batch-set-category",function(t){return e.batchSetCategory(t)}),this.$itemList.on("click",".js-item-edit",function(t){return e.itemEdit(t)}),this.$itemList.on("click",".js-item-delete",function(t){return e.deleteSubjectItem(t)}),this.$itemList.on("change",".js-testpaper-title",function(t){return e.editTestpaperTitle(t)}),this.$itemList.on("click",".js-import-btn",function(t){return e.finishImport(t)})}},{key:"initTestpaperTitle",value:function(){var i=this;this.isTestpaper()&&(this.testpaperTitle=$(".js-testpaper-title").val()),this.$itemList.on("click",".subject-change-btn",function(t){return i.itemConvert(t)}),this.$itemList.on("click",".js-item-add",function(t){return i.addModalShow(t,!1)}),this.$itemList.on("click",".js-item-add-sub",function(t){return i.addModalShow(t,!0)}),this.$subjectData.bind("change","*[data-type]",function(t,e){return i.updateQuestionCountText(e)}),this.$subjectData.bind("change",".js-total-score",function(t){return i.updateTotalScoreText()})}},{key:"sbListFixed",value:function(){var e,i,n=$(".js-subject-data").width();this.$element.length&&(i=(e=this).$element.offset().top,$(window).scroll(function(t){e.$element.width(n),$(window).scrollTop()>=i?e.$element.addClass("sb-fixed"):e.$element.removeClass("sb-fixed")}))}},{key:"footerButtonFixed",value:function(){window.addEventListener("scroll",Object(A.a)(this.scrollBottom,100,!0))}},{key:"scrollBottom",value:function(){var n=$(".js-subject-item-btn");$(window).scroll(function(t){var e=a()(window.scrollY+document.documentElement.clientHeight),i=0;$(".es-footer-link").length?i=a()($(".es-footer-link").offset().top):$(".es-footer").length&&(i=a()($(".es-footer").offset().top)),i?e<i?n.addClass("subject-bottom-fixed"):n.removeClass("subject-bottom-fixed"):(e=a()($(document).scrollTop()),i=a()($(document.body).height()),e+a()($(window).height())<i-560?n.addClass("subject-bottom-fixed"):n.removeClass("subject-bottom-fixed"))})}},{key:"batchToItem",value:function(t){t.currentTarget===t.target&&($(t.currentTarget).hasClass("checked")?this.$element.find(".js-show-checkbox").removeClass("checked"):this.$element.find(".js-show-checkbox").addClass("checked"))}},{key:"itemToBatch",value:function(t){t.currentTarget===t.target&&this.countNumber()}},{key:"countNumber",value:function(){var e=this.$element.find(".js-show-checkbox").length,i=this;setTimeout(function(){var t=$(".js-subject-list-body").find(".checked").length;e===t?i.$allBtn.addClass("checked"):i.$allBtn.removeClass("checked")},100)}},{key:"batchBtnClick",value:function(t){this.isEditing()||($(t.target).toggleClass("hidden"),this.toggleClass(!0),this.flag=!1)}},{key:"finishBtnClick",value:function(){this.$element.find(".js-show-checkbox").removeClass("checked"),this.$allBtn.removeClass("checked"),this.$batchBtn.toggleClass("hidden"),this.toggleClass(!1),this.flag=!0}},{key:"toggleClass",value:function(t){t?(this.$element.find(".js-subject-wrap").removeClass("hidden"),this.$element.find(".js-show-checkbox").removeClass("hidden")):(this.$element.find(".js-subject-wrap").addClass("hidden"),this.$element.find(".js-show-checkbox").addClass("hidden"))}},{key:"quickToQuestion",value:function(t,e){t=$(t.currentTarget);e?(e=$(t.attr("data-anchor")).offset(),$(document).scrollTop(e.top)):(t.find(".js-show-checkbox").toggleClass("checked"),this.countNumber())}},{key:"showModal",value:function(t,e){var i,n;this.isEditing()||(i=this.statChosedQuestion(),0!==s()(i).length?(n="",$.each(i,function(t,e){e=e.count+Translator.trans("subject.question_unit")+e.name+Translator.trans("subject.comma");n+=e}),n=n.substring(0,n.length-1)+Translator.trans("subject.period"),e.find(".js-select").html(n),e.modal("show")):cd.message({type:"danger",message:Translator.trans("subject.select_question_hint")}))}},{key:"showScoreModal",value:function(t){var e,i;this.isEditing()||(e=this.statChosedQuestion(),i=$(".js-miss-score-field"),this.isTestpaper()&&(e.hasOwnProperty("choice")||e.hasOwnProperty("uncertain_choice"))?i.removeClass("hidden"):i.addClass("hidden"),null!=this.scoreValidator&&this.scoreValidator.resetForm(),this.$scoreModal.find("input").each(function(){$(this).val("")}),this.showModal(t,this.$scoreModal))}},{key:"statChosedQuestion",value:function(){var n={},s=this;return s.$element.find(".js-show-checkbox.checked").each(function(){var t=$(this).data("type"),e=$(this).parent().next(".js-type-name").text(),i=$(this).parents(".js-subject-anchor").data("anchor");void 0===n[t]?n[t]={name:e,count:1}:n[t].count++,s.selectQuestion.push(i.substr(1))}),n}},{key:"initScoreValidator",value:function(){this.scoreValidator=$("#batch-set-score-form").validate({onkeyup:!1,rules:{score:{required:!0,max:999,min:0,es_score:!0},missScore:{required:!1,max:999,min:0,noMoreThan:"#score",es_score:!0}},messages:{missScore:{noMoreThan:Translator.trans("subject.miss_score_no_more_than_score")}}}),$.validator.addMethod("noMoreThan",function(t,e,i){return""==t||h()(t)<=h()($(i).val())},"Please enter a lesser value.")}},{key:"isTestpaper",value:function(){return 1==$('input[name="isTestpaper"]').val()}},{key:"batchSetScore",value:function(){var t;this.scoreValidator.form()&&(t={score:this.$scoreModal.find('input[name="score"]').val(),missScore:this.$scoreModal.find('input[name="missScore"]').val()},this.questionOperate.modifyScore(this.selectQuestion,t,this.isTestpaper()),this.selectQuestion=[],cd.message({type:"success",message:Translator.trans("subject.score_update_success")}),this.$scoreModal.modal("hide"))}},{key:"batchSetCategory",value:function(){var t=this.$categoryModal.find("#categoryId").val(),e=this.$categoryModal.find("#categoryId").find("option:selected").text();this.questionOperate.modifyCategory(this.selectQuestion,t,$.trim(e)),this.selectQuestion=[],cd.message({type:"success",message:Translator.trans("subject.category_update_success")}),this.$categoryModal.modal("hide")}},{key:"setDifficulty",value:function(){var i=this;$(".js-difficulty-btn").click(function(){var t=$("input[name='difficultyRadios']:checked").val(),e=$("input[name='difficultyRadios']:checked").next().text();i.questionOperate.modifyDifficulty(i.selectQuestion,t,e),i.selectQuestion=[],cd.message({type:"success",message:Translator.trans("subject.difficulty_update_success")}),i.$diffiultyModal.modal("hide")})}},{key:"itemEdit",value:function(t){var e,i,n,s,a,o;this.isEditing()||(e=this,n="",s={},o=i=0,t=$(t.currentTarget),a=t.parents(".subject-item"),t=t.parents(".subject-item__operation").data("url"),void 0!==a.attr("data-material-token")?(i=a.data("key"),n=a.attr("data-material-token"),s=this.questionOperate.getSubQuestion(n,i),o=1,i++):(i=this.questionOperate.getQuestionOrder(a.attr("id")),s=this.questionOperate.getQuestion(a.attr("id")),n=a.attr("id")),o={seq:i,token:n,question:s,isSub:o,method:"edit",isTestpaper:this.isTestpaper()?1:0,questionBankId:this.questionBankId},$.post(t,o,function(t){a.replaceWith(t),B.getEditor(s.type,$(".js-edit-form"),e.questionOperate),e.initSelect()}))}},{key:"itemConvert",value:function(t){var e=$(t.currentTarget),i=e.parents(".subject-item"),n=e.data("type"),s=e.parents(".subject-change-list").data("fromType"),a=e.parents(".js-edit-form"),o=e.parents(".subject-change-list").data("convertUrl"),t=c._serializeArrayConvertToJson(a.serializeArray());0<$(".js-attachment-list").length&&(r={},0<$(".js-attachment-list-stem").find(".js-attachment-name").length&&(r.stem={type:"attachment",targetType:"question.stem",fileIds:$(".js-attachment-ids-stem").val(),fileName:$(".js-attachment-list-stem").find(".js-attachment-name").text()}),0<$(".js-attachment-list-analysis").find(".js-attachment-name").length&&(r.analysis={type:"attachment",targetType:"question.analysis",fileIds:$(".js-attachment-ids-analysis").val(),fileName:$(".js-attachment-list-analysis").find(".js-attachment-name").text()}),t.attachment=r);var e=$(".js-edit-form-seq").text(),a=$(".js-sub-judge").val(),r=$(".js-hidden-method").val(),r={seq:e,token:t.token,question:t,fromType:s,toType:n,isSub:a,method:r,isTestpaper:this.isTestpaper()?1:0,questionBankId:this.questionBankId};r.fromType=s,r.toType=n;var u=this;$.post(o,r,function(t){i.replaceWith(t),B.getEditor(n,$(".js-edit-form"),u.questionOperate)})}},{key:"itemClick",value:function(){var a=this;$(".js-create-btn").on("click",function(t){var s=$(t.target);a.timer&&clearTimeout(a.timer),a.timer=setTimeout(function(){s.attr("disabled",!0);var t=$("#cd-modal"),e=t.attr("data-sub"),i=s.data("url"),n=t.attr("data-index"),t=s.data("type");"false"==e?a.itemAdd(n,t,i,s):a.subItemAdd(n,t,i)},500)})}},{key:"itemAdd",value:function(i,n,t,s){var a=this,o=a.questionOperate.getQuestionOrder(i)+1,e=this.isTestpaper()?1:0,e={seq:o,token:i,method:"add",isTestpaper:e,questionBankId:this.questionBankId};$.post(t,e).then(function(t){$("#cd-modal").modal("hide"),$(".js-create-btn").attr("disabled",!1);var e=o+1;a.orderQuestionList(e,$('[data-anchor="#'.concat(i,'"]')).parent(),$("#".concat(i))),$('[data-anchor="#'.concat(i,'"]')).parent().after(a.getNewListItem(o,n,s.text())),a.statErrorQuestions(),($("#".concat(i)).next(".subject-item").hasClass("subject-sub-item")?$('[data-material-token="'.concat(i,'"]')).last():$("#".concat(i))).after(t),B.getEditor(n,$(".js-edit-form"),a.questionOperate)})}},{key:"subItemAdd",value:function(e,i,t){var n=this,s=this.questionOperate.getQuestion(e).subQuestions.length+1,a=this.isTestpaper()?1:0,a={seq:s,token:e,method:"add",isSub:1,isTestpaper:a,questionBankId:this.questionBankId};$.post(t,a).then(function(t){$("#cd-modal").modal("hide"),$(".js-create-btn").attr("disabled",!1),($("#".concat(e)).next(".subject-item").hasClass("subject-sub-item")?$('[data-material-token="'.concat(e,'"]')).last():$("#".concat(e))).after(t),B.getEditor(i,$(".js-edit-form"),n.questionOperate)})}},{key:"getNewListItem",value:function(t,e,i){return("material"!==e?'<div class="col-sm-3 subject-list-item js-subject-list-item">\n          <div class="subject-list-item__num  js-subject-anchor" data-anchor="#'.concat(t,'">\n            <span class="js-list-index">').concat(t,'</span>\n            <label class="sb-checkbox cd-checkbox js-show-checkbox hidden" data-type="').concat(e,'"><input type="checkbox" data-toggle="cd-checkbox"></label>\n          </div>\n          <span class="js-type-name">'):'<div class="col-sm-3 subject-list-item js-subject-list-item">\n          <div class="subject-list-item__num  js-subject-anchor" data-anchor="#'.concat(t,'">\n            <span class="js-list-index">').concat(t,'</span>\n          </div>\n          <span class="js-type-name">')).concat(i,"</span>\n        </div>")}},{key:"deleteSubjectItem",value:function(r){var u=this;this.isEditing()||(this.questionOperate.getTokenList().length<2?cd.message({type:"danger",message:Translator.trans("subject.question_delete_tip")}):cd.confirm({title:Translator.trans("subject.delete.title"),content:Translator.trans("subject.delete.content"),okText:Translator.trans("site.confirm"),cancelText:Translator.trans("site.cancel")}).on("ok",function(){var t,e,i,n,s,a=$(r.currentTarget).parent().parent(),o=a.attr("id");a.hasClass("subject-sub-item")?(o=a.attr("data-material-token"),n=a.attr("data-key"),u.questionOperate.deleteSubQuestion(o,n),a.remove(),u.changeBottomFixed(),t=0,$('[data-material-token="'.concat(o,'"]')).each(function(){$(this).attr("id","sub".concat(t)),$(this).attr("data-key",t++),$(this).find(".subject-sub-item__number").text("(".concat(t,")"))})):(e=u.questionOperate.getQuestion(o),i=u.questionOperate.getQuestionOrder(o),n=$("[data-anchor=#".concat(o,"]")).parent(),u.orderQuestionList(i,n,a),u.questionOperate.deleteQuestion(o),s=u,"material"===e.type&&a.nextUntil(".js-subject-main-item").each(function(){$(this).remove(),s.changeBottomFixed()}),n.remove(),a.remove(),s.changeBottomFixed(),u.statErrorQuestions())}))}},{key:"changeBottomFixed",value:function(){var t=a()(window.scrollY+document.documentElement.clientHeight),e=0;$(".es-footer-link").length?e=a()($(".es-footer-link").offset().top):$(".es-footer").length&&(e=a()($(".es-footer").offset().top)),e?e<t&&$(".js-subject-item-btn").removeClass("subject-bottom-fixed"):(t=a()($(document).scrollTop()),a()($(document.body).height())-560<=t+a()($(window).height())&&$(".js-subject-item-btn").removeClass("subject-bottom-fixed"))}},{key:"editTestpaperTitle",value:function(t){var e=$(t.target).val();if(""===$.trim(e))return cd.message({type:"danger",message:Translator.trans("subject.testpaper_title_empty_hint")}),void $(t.target).val(this.testpaperTitle);for(var i=e.length,n=0;n<e.length;n++)127<e.charCodeAt(n)&&i++;if(50<i)return cd.message({type:"danger",message:Translator.trans("subject.testpaper_title_too_long_hint")}),void $(t.target).val(this.testpaperTitle);this.testpaperTitle=e}},{key:"updateQuestionCountText",value:function(t){var e=this.questionOperate.getQuestionCount("total"),i=this.questionOperate.getQuestionCount(t);$(".js-total-num").text(Translator.trans("subject.question_count",{count:e})),$("[data-type=".concat(t,"]")).find(".subject-data__num").text(Translator.trans("subject.question_count",{count:i}))}},{key:"updateTotalScoreText",value:function(t){t=!(0<arguments.length&&void 0!==t)||t;this.isTestpaper()&&t&&(t=h()(this.questionOperate.getTotalScore()).toFixed(1),$(".js-total-score").text(Translator.trans("subject.total_score",{totalScore:t})))}},{key:"orderQuestionList",value:function(t,e,i){var n=t,s=t;e.nextAll(".subject-list-item").each(function(){$(this).find(".js-list-index").text(n),n++}),i.nextAll(".subject-item").not(".subject-sub-item").each(function(){$(this).find(".subject-item__number").text(s),s++})}},{key:"finishImport",value:function(t){var e,i,n,s,a;this.isEditing()||(e=!1,n="",(i=this).$element.find(".subject-list-item__num--error").each(function(){n=n+$(this).find(".js-list-index").text()+"、",e=!0}),n=Translator.trans("subject.question_error_tip",{seqs:n.substring(0,n.length-1)}),e?cd.message({type:"danger",message:n}):this.isMaterialHasSub()&&(s=this.isTestpaper()?this.testpaperTitle:"",(a=$(t.currentTarget)).button("loading"),$.ajax({type:"POST",url:a.data("url"),data:o()({title:s,questions:this.questionOperate.getQuestions()}),dataType:"json",contentType:"application/json;charset=utf-8",success:function(t){!0===t&&(a.button("reset"),cd.message({type:"success",message:Translator.trans("subject.save_success")}),i.redirect=!0,window.location.href=a.data("redirectUrl"))}})))}},{key:"isMaterialHasSub",value:function(){for(var t=this.questionOperate.getTokenList(),e=0;e<t.length;e++){var i=t[e],n=this.questionOperate.getQuestion(i);if("material"===n.type&&0===n.subQuestions.length){i=this.questionOperate.getQuestionOrder(i);return cd.message({type:"danger",message:Translator.trans("subject.material_nosub_tip",{seq:i})}),!1}}return!0}},{key:"statErrorQuestions",value:function(){var t="",e=!1;this.$element.find(".subject-list-item__num--error").each(function(){t=t+$(this).find(".js-list-index").text()+"、",e=!0}),t=Translator.trans("subject.question_error_tip",{seqs:t.substring(0,t.length-1)}),e?$(".js-error-tip").html(t):$(".js-error-tip").html("")}},{key:"addModalShow",value:function(t,e){var i;this.isEditing()||(i=$(t.currentTarget),t=$("#cd-modal"),i=i.closest(".js-subject-item").attr("id"),e?(t.find('[data-type="material"]').addClass("hidden"),t.attr("data-sub","true")):(t.find('[data-type="material"]').removeClass("hidden"),t.attr("data-sub","false")),t.attr("data-index",i),t.modal("show"))}},{key:"isEditing",value:function(){var t=$(".js-subject-edit-item"),e=t.hasClass("js-sub-edit-item"),i="";if(0===t.length)return!1;var n=t.find(".js-edit-form-seq").text();e&&(t=t.find(".js-hidden-token").val(),t=$("#".concat(t)).find(".js-subject-item-number").text(),i=$.trim(t));n=e?Translator.trans("subject.sub_is_editing_warning",{parentNum:i,seq:n}):Translator.trans("subject.is_editing_warning",{seq:n});return cd.message({type:"warning",message:n}),!0}},{key:"questionTypeConvert",value:function(t,e){e=$(".js-subject-list").find("[data-anchor=#".concat(e,"]"));e.find(".js-show-checkbox").attr("data-type",t),e.next(".js-type-name").text(this.getTypeName(t))}},{key:"getTypeName",value:function(t){switch(t){case"single_choice":return Translator.trans("course.question.type.single_choice");case"uncertain_choice":return Translator.trans("course.question.type.uncertain_choice");case"choice":return Translator.trans("course.question.type.choice");case"determine":return Translator.trans("course.question.type.determine");case"essay":return Translator.trans("course.question.type.essay");case"fill":return Translator.trans("course.question.type.fill");case"material":return Translator.trans("course.question.type.material");default:return Translator.trans("course.question.type.unknown")}}},{key:"ieImg",value:function(){(p.a.ie10||p.a.ie11)&&this.$itemList.addClass("ie-item-list")}}],[{key:"_serializeArrayConvertToJson",value:function(t){var e={},i=P(t);try{for(i.s();!(n=i.n()).done;){var n=n.value;e[n.name]?(e[n.name].push||(e[n.name]=[e[n.name]]),e[n.name].push(n.value)):e[n.name]=n.value}}catch(t){i.e(t)}finally{i.f()}return e}}]),c}();new U}});