(window.webpackJsonp=window.webpackJsonp||[]).push([["testpaperDo"],{"057e":function(t,e,i){"use strict";i("8e6e"),i("ac6a"),i("456d");var n=i("bd86"),s=i("2f62");function a(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}var r={name:"GuidePage",data:function(){return{isFristVisited:!1}},computed:function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach((function(e){Object(n.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},Object(s.d)({user:function(t){return t.user}})),created:function(){this.setVisited()},methods:{setVisited:function(){var t="".concat(this.user.id,"-task-visited");localStorage.getItem(t),localStorage.getItem(t)||(this.isFristVisited=!0,localStorage.setItem(t,!0))}}},c=i("a6c2"),o=Object(c.a)(r,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.isFristVisited,expression:"isFristVisited"}],staticClass:"guide",on:{click:function(e){t.isFristVisited=!1}}},[i("div",{staticClass:"guide__text"},[t._v("左右切换滑动")]),t._m(0)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"guide__gesture"},[e("img",{attrs:{src:"static/images/leftslide.png"}}),e("img",{attrs:{src:"static/images/rightslide.png"}})])}],!1,null,null,null);e.a=o.exports},"3fc6":function(t,e,i){"use strict";i.r(e),i("8e6e"),i("a481"),i("456d"),i("ac6a"),i("c5f6"),i("e7e5");var n=i("d399"),s=i("bd86"),a=(i("e17f"),i("2241")),r=(i("f1dc"),i("6e47")),c=i("3ce7"),o=i("2f62"),u=i("faa5"),l=i("057e"),m=i("f5cc"),d=i("0d25"),f=i("b7cf"),h=i("8ae7");function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function g(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach((function(e){Object(s.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var b="",v={name:"TestpaperDo",components:{itemBank:m.a,guidePage:l.a,vanOverlay:r.a},filters:{type:function(t){switch(t){case"single_choice":return"单选题";case"choice":return"多选题";case"essay":return"问答题";case"uncertain_choice":return"不定项选择题";case"determine":return"判断题";case"fill":return"填空题";case"material":return"材料题"}}},mixins:[f.a,h.a],data:function(){return{cardSeq:0,testpaper:{},testpaperResult:{},info:[],answer:{},cardShow:!1,items:{},time:null,timeMeter:null,timeWarn:!1,isHandExam:!1,localtime:null,localtimeName:null,localanswerName:null,localuseTime:null,lastAnswer:null,lastTime:null,startTime:null,backUrl:"",slideIndex:0}},created:function(){this.getData()},beforeRouteEnter:function(t,e,i){b="/"===e.fullPath?"/":"",i()},beforeRouteLeave:function(t,e,i){0==this.info.length||this.isHandExam||"doing"!=this.testpaperResult.status?i():this.submitPaper().then((function(){i()})).catch((function(){i(!1)}))},beforeDestroy:function(){this.clearTime(),a.a.close()},computed:g({},Object(o.d)({isLoading:function(t){return t.isLoading},user:function(t){return t.user}})),watch:{answer:{handler:"saveAnswer",deep:!0}},methods:g(g({},Object(o.b)("course",["handExamdo"])),{},{getData:function(){var t=this,e=this.$route.query.testId,i=this.$route.query.targetId,s=this.$route.query.action;c.a.getExamInfo({query:{testId:e},data:{action:s,targetId:i,targetType:"task"}}).then((function(e){t.afterGetData(e)})).catch((function(e){4032207==e.code||4032204==e.code?t.toIntro():(n.a.fail(e.message),t.showResult())}))},afterGetData:function(t){this.$store.commit(u.n,this.$route.query.title),this.items=t.items,this.testpaper=t.testpaper,t.testpaperResult.limitedTime=Number(t.testpaperResult.limitedTime),this.testpaperResult=t.testpaperResult,this.isDoing()||(this.localanswerName="".concat(this.user.id,"-").concat(this.testpaperResult.id),this.localtimeName="".concat(this.user.id,"-").concat(this.testpaperResult.id,"-time"),this.lastTime=localStorage.getItem(this.localtimeName),this.lastAnswer=JSON.parse(localStorage.getItem(this.localanswerName)),this.formatData(t),this.interruption(),this.saveTime(),this.timer())},isDoing:function(){return"doing"!=this.testpaperResult.status&&(this.showResult(),!0)},interruption:function(){var t=this;this.$route.params.KeepDoing||this.canDoing(this.testpaperResult,this.user.id).then((function(){})).catch((function(e){var i=e.answer,n=e.endTime;t.submitExam(i,n)}))},formatData:function(t){var e=this,i=t.items;Object.keys(i).forEach((function(t){"material"!=t&&i[t].forEach((function(t){var i=e.sixType(t.type,t,e.lastAnswer);e.$set(e.answer,t.id,i.answer),e.info.push(i.item)})),"material"==t&&i[t].forEach((function(t){var i=Object.assign({},t,{subs:""});t.subs.forEach((function(n,s){n.parentTitle=i,n.parentType=t.type,n.materialIndex=s+1;var a=e.sixType(n.type,n,e.lastAnswer);e.$set(e.answer,n.id,a.answer),e.info.push(a.item)}))}))}))},formatStatus:function(t,e){var i=0;return("single_choice"==t||"choice"==t||"uncertain_choice"==t||"determine"==t)&&this.answer[e].length>0||"essay"==t&&""!=this.answer[e][0]?i=1:"fill"==t?i=Number(this.answer[e].some((function(t){return""!=t}))):i},slideToNumber:function(t){var e=Number(t);this.cardSeq=e,this.cardShow=!1},timer:function(t){var e=this,i=0,n=60*this.testpaperResult.limitedTime*1e3;if(!(n<=0)){if(this.lastTime){var s=Math.ceil((new Date).getTime()-1e3*this.testpaperResult.beginTime);n-=s}this.timeMeter=setInterval((function(){var t=Object(d.getCountDown)(n,i++),s=t.hours,a=t.minutes,r=t.seconds;e.time="".concat(s,":").concat(a,":").concat(r),0==s&&0==a&&r<60&&(e.timeWarn=!0),(0==Number(s)&&0==Number(a)&&0==Number(r)||Number(r)<0)&&(e.clearTime(),e.submitExam())}),1e3)}},clearTime:function(){clearInterval(this.timeMeter),this.timeMeter=null,clearInterval(this.localtime),this.localtime=null},submitPaper:function(){var t=this,e=0,i="题目已经做完，确认交卷吗?",n=JSON.parse(JSON.stringify(this.answer));return Object.keys(n).forEach((function(t){n[t]=n[t].filter((function(t){return""!==t})),0===n[t].length&&e++})),e>0&&(i="还有".concat(e,"题未做，确认交卷吗？")),new Promise((function(e,s){a.a.confirm({title:"交卷",cancelButtonText:"确认交卷",confirmButtonText:"检查一下",message:i}).then((function(){t.cardShow=!0,s()})).catch((function(){t.clearTime(),t.submitExam(n).then((function(t){e()})).catch((function(t){s()}))}))}))},submitExam:function(t,e){var i=this;t||(t=JSON.parse(JSON.stringify(this.answer)),Object.keys(t).forEach((function(e){t[e]=t[e].filter((function(t){return""!==t}))}))),e=e||(new Date).getTime();var s={answer:t,resultId:this.testpaperResult.id,userId:this.user.id,endTime:e,beginTime:Number(this.testpaperResult.beginTime)};return new Promise((function(t,e){i.handExamdo(s).then((function(e){i.isHandExam=!0,t(),i.showResult()})).catch((function(t){e(),n.a.fail(t.message),i.isHandExam=!0,i.showResult()}))}))},saveAnswer:function(t){localStorage.setItem(this.localanswerName,JSON.stringify(t))},saveTime:function(){var t=this;this.localuseTime="".concat(this.user.id,"-").concat(this.testpaperResult.id,"-usedTime");var e=localStorage.getItem(this.localuseTime)||0;this.localtime=setInterval((function(){t.testpaperResult.limitedTime||localStorage.setItem(t.localuseTime,++e),localStorage.setItem(t.localtimeName,(new Date).getTime())}),1e3)},showResult:function(){this.$router.replace({name:"testpaperResult",query:{resultId:this.testpaperResult.id,testId:this.$route.query.testId,targetId:this.$route.query.targetId,backUrl:b}})},toIntro:function(){this.$router.replace({name:"testpaperIntro",query:{testId:this.$route.query.testId,targetId:this.$route.query.targetId}})}})},w=i("a6c2"),y=Object(w.a)(v,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"paper-swiper"},[t.isLoading?i("e-loading"):t._e(),t.info.length>0?i("item-bank",{attrs:{current:t.cardSeq,info:t.info,answer:t.answer,"slide-index":t.slideIndex,all:t.info.length},on:{"update:current":function(e){t.cardSeq=e},"update:answer":function(e){t.answer=e},"update:slideIndex":function(e){t.slideIndex=e},"update:slide-index":function(e){t.slideIndex=e}}}):t._e(),i("guide-page"),i("div",{staticClass:"paper-footer"},[i("div",[i("span",{on:{click:function(e){t.cardShow=!0}}},[i("i",{staticClass:"iconfont icon-Questioncard"}),t._v("\n        题卡\n      ")])]),i("div",[i("span",{on:{click:function(e){return t.submitPaper()}}},[i("i",{staticClass:"iconfont icon-submit"}),t._v("\n        交卷\n      ")])])]),i("van-popup",{attrs:{position:"bottom"},model:{value:t.cardShow,callback:function(e){t.cardShow=e},expression:"cardShow"}},[t.info.length>0?i("div",{staticClass:"card"},[i("div",{staticClass:"card-title"},[i("div",[i("span",{staticClass:"card-finish"},[t._v("已完成")]),i("span",{staticClass:"card-nofinish"},[t._v("未完成")])]),i("i",{staticClass:"iconfont icon-no",on:{click:function(e){t.cardShow=!1}}})]),i("div",{staticClass:"card-list"},t._l(t.items,(function(e,n){return i("div",{key:n,staticClass:"card-item"},[i("div",{staticClass:"card-item-title"},[t._v(t._s(t._f("type")(n)))]),"material"!=n?i("div",{staticClass:"card-item-list"},t._l(t.items[n],(function(e){return i("div",{key:e.id,class:["list-cicle",1==t.formatStatus(e.type,e.id)?"cicle-active":""],on:{click:function(i){return t.slideToNumber(e.seq)}}},[t._v("\n              "+t._s(e.seq)+"\n            ")])})),0):t._e(),"material"==n?i("div",{staticClass:"card-item-list"},[t._l(t.items[n],(function(e){return t._l(e.subs,(function(e){return i("div",{key:e.id,class:["list-cicle",1==t.formatStatus(e.type,e.id)?"cicle-active":""],on:{click:function(i){return t.slideToNumber(e.seq)}}},[t._v("\n                "+t._s(e.seq)+"\n              ")])}))}))],2):t._e()])})),0)]):t._e()]),i("div",{class:["time",t.timeWarn?"warn":""]},[t._v("\n    "+t._s(t.time)+"\n  ")])],1)}),[],!1,null,null,null);e.default=y.exports},b7cf:function(t,e,i){"use strict";i("c5f6"),i("e17f");var n=i("2241");i("456d"),i("ac6a"),e.a={methods:{canDoing:function(t,e){return new Promise((function(i,s){if(t&&"doing"===t.status){var a="".concat(e,"-").concat(t.id),r=JSON.parse(localStorage.getItem(a));r=r?Object.keys(r).forEach((function(t){r[t]=r[t].filter((function(t){return""!==t}))})):{},n.a.confirm({title:"提示",cancelButtonText:"放弃考试",confirmButtonText:"继续考试",message:"您有未完成的考试，是否继续？"}).then((function(){if(Number(t.limitedTime)>0){var e=Math.ceil(((new Date).getTime()-1e3*t.beginTime)/1e3/60);if(Number(e)>Number(t.limitedTime)){var n=Number(1e3*t.beginTime)+Number(60*t.limitedTime*1e3);return void s({answer:r,endTime:n})}}i()})).catch((function(){s({answer:r,endTime:null})}))}}))}}}}}]);