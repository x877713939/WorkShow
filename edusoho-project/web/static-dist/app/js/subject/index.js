!function(u){function t(t){for(var e,i,n=t[0],s=t[1],a=t[2],r=0,o=[];r<n.length;r++)i=n[r],Object.prototype.hasOwnProperty.call(l,i)&&l[i]&&o.push(l[i][0]),l[i]=0;for(e in s)Object.prototype.hasOwnProperty.call(s,e)&&(u[e]=s[e]);for(h&&h(t);o.length;)o.shift()();return d.push.apply(d,a||[]),c()}function c(){for(var t,e=0;e<d.length;e++){for(var i=d[e],n=!0,s=1;s<i.length;s++){var a=i[s];0!==l[a]&&(n=!1)}n&&(d.splice(e--,1),t=r(r.s=i[0]))}return t}var i={},l={284:0},d=[];function r(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return u[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}r.m=u,r.c=i,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/static-dist/";var e=window.webpackJsonp=window.webpackJsonp||[],n=e.push.bind(e);e.push=t,e=e.slice();for(var s=0;s<e.length;s++)t(e[s]);var h=n;d.push([719,0]),c()}({152:function(t,e,i){t.exports=i(301)},17:function(t,e){t.exports=jQuery},248:function(t,e,i){i(249);var n=i(27).Object;t.exports=function(t,e){return n.getOwnPropertyDescriptor(t,e)}},249:function(t,e,i){var n=i(93),s=i(137).f;i(263)("getOwnPropertyDescriptor",function(){return function(t,e){return s(n(t),e)}})},291:function(n,t,e){var a=e(45),s=e(694),r=e(697);function o(t,e,i){return"undefined"!=typeof Reflect&&s?n.exports=o=s:n.exports=o=function(t,e,i){var n=r(t,e);if(n){var s=a(n,e);return s.get?s.get.call(i):s.value}},o(t,e,i||t)}n.exports=o},301:function(t,e,i){i(287),i(266),t.exports=i(302)},302:function(t,e,i){var n=i(86),s=i(299);t.exports=i(27).getIterator=function(t){var e=s(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},45:function(t,e,i){t.exports=i(248)},694:function(t,e,i){t.exports=i(695)},695:function(t,e,i){i(696),t.exports=i(27).Reflect.get},696:function(t,e,i){var r=i(137),o=i(341),u=i(254),n=i(48),c=i(140),l=i(86);n(n.S,"Reflect",{get:function t(e,i){var n,s,a=arguments.length<3?e:arguments[2];return l(e)===a?e[i]:(n=r.f(e,i))?u(n,"value")?n.value:void 0!==n.get?n.get.call(a):void 0:c(s=o(e))?t(s,i,a):void 0}})},697:function(t,e,i){var n=i(5);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}},719:function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return st});var n=i(152),u=i.n(n),s=i(252),c=i.n(s),a=i(251),l=i.n(a),r=i(150),d=i.n(r),o=i(151),h=i.n(o),f=i(18),p=i.n(f),m=i(12),v=i.n(m),g=i(28),y=i.n(g),b=i(6),k=i.n(b),j=i(0),T=i.n(j),_=i(1),q=i.n(_),x=i(16),w=function(){function t(){T()(this,t),this.questions={},this.eventManager={},this.tokenList=[],this.$itemList=$(".js-item-list"),this.questionCounts={},this.totalScore=0,this.flag=!0,this.init()}return q()(t,[{key:"init",value:function(){this.initQuestions(),this.initQuestionCountsAndTotalScore(),this.flag=!1}},{key:"initQuestions",value:function(){for(var a=this,r=this._toJson($(".js-cached-data").text()),t=0;t<r.length;t++)!function(t){var i=a._getToken(),e=r[t];e.categoryId=0,a.questions[i]=e,a.tokenList.push(i);var n=t;$('[data-anchor="#'.concat(n,'"]')).attr("data-anchor","#".concat(i));var s=$("#".concat(n)).attr("id",i);"material"===e.type&&$.each(e.subQuestions,function(t,e){s=s.next('[data-key="'.concat(t,'"]')).attr("data-material-token",i)})}(t)}},{key:"initQuestionCountsAndTotalScore",value:function(){this.questionCounts={total:0,single_choice:0,choice:0,uncertain_choice:0,determine:0,fill:0,essay:0,material:0};var i=this;y()(this.questions).forEach(function(t){var e=i.questions[t];i.questionCounts.total++,i.questionCounts[e.type]++,"material"!==e.type?i.totalScore=(v()(i.totalScore)+v()(e.score)).toFixed(1):$.each(e.subQuestions,function(t,e){i.totalScore=(v()(i.totalScore)+v()(e.score)).toFixed(1)})})}},{key:"getQuestionCount",value:function(t){return this.questionCounts[t]}},{key:"getTotalScore",value:function(){return this.totalScore}},{key:"getQuestionOrder",value:function(t){return this.tokenList.indexOf(t)+1}},{key:"getTokenList",value:function(){return this.tokenList}},{key:"modifyDifficulty",value:function(t,i,n){var s=this;$.each(t,function(t,e){void 0!==s.questions[e]&&(s.updateQuestionItem(e,"difficulty",i),s.$itemList.find("#".concat(e)).find(".js-difficulty").html(n))})}},{key:"modifyScore",value:function(t,n,s){var a=this;$.each(t,function(t,e){a.$itemList.find("#".concat(e)).find(".js-score").html("".concat(n.score).concat(Translator.trans("subject.question_score_unit")));var i=a.getQuestion(e);a.updateQuestionItem(e,"score",n.score,!1),s&&("choice"!==i.type&&"uncertain_choice"!==i.type||a.updateQuestionItem(e,"missScore",n.missScore))}),a.trigger("updateQuestionScore")}},{key:"modifyCategory",value:function(t,i,n){var s=this;$.each(t,function(t,e){void 0!==s.questions[e]&&(s.updateQuestionItem(e,"categoryId",i),s.$itemList.find("#".concat(e)).find(".js-category").html(Object(x.h)(n,8)),s.$itemList.find("#".concat(e)).find(".js-category").attr("data-original-title",n))})}},{key:"addQuestion",value:function(t,e){if(this.isUpdating()){this.flag=!0,"material"===e.type&&(e.subQuestions=[],e.score=0);var i=this._getToken();this.questions[i]=e;var n=this.tokenList.indexOf(t)+1;this.tokenList.splice(n,0,i),this.questionCounts.total++,this.questionCounts[e.type]++,this.totalScore=(v()(this.totalScore)+v()(e.score)).toFixed(1);var s=n+1;return this.trigger("addQuestion",[s,i,e.type]),this.flag=!1,i}}},{key:"deleteQuestion",value:function(t){var e,i,n;this.isUpdating()&&(this.flag=!0,e=this.questions[t],delete this.questions[t],i=this.tokenList.indexOf(t),this.tokenList.splice(i,1),this.questionCounts.total--,this.questionCounts[e.type]--,"material"!==e.type?this.totalScore=(v()(this.totalScore)-v()(e.score)).toFixed(1):(n=this,$.each(e.subQuestions,function(t,e){n.totalScore=(v()(n.totalScore)-v()(e.score)).toFixed(1)})),this.trigger("deleteQuestion",[e.type]),this.flag=!1)}},{key:"updateQuestionItem",value:function(t,e,i,n){var s,a=!(3<arguments.length&&void 0!==n)||n;this.isUpdating()&&(this.flag=!0,s=this.questions[t][e],this.questions[t][e]=i,"score"===e&&(this.totalScore=(this.totalScore-v()(s)+v()(i)).toFixed(1),this.trigger("updateQuestionScore",[a])),"type"===e&&s!=i&&(this.questionCounts[s]--,this.questionCounts[i]++,this.trigger("updateQuestionType",[e,i,s,t])),this.flag=!1)}},{key:"getQuestion",value:function(t){if(this.isUpdating())return this.questions[t]}},{key:"getQuestions",value:function(){return this.questions}},{key:"getSubQuestion",value:function(t,e){if(this.isUpdating())return this.questions[t].subQuestions[e]}},{key:"addSubQuestion",value:function(t,e){if(this.isUpdating())return this.flag=!0,this.questions[t].subQuestions.push(e),this.totalScore=(v()(this.totalScore)+v()(e.score)).toFixed(1),this.trigger("updateQuestionScore"),this.flag=!1,t}},{key:"updateSubQuestionItem",value:function(t,e,i,n,s){var a,r=!(4<arguments.length&&void 0!==s)||s;this.isUpdating()&&(this.flag=!0,a=this.questions[t].subQuestions[e][i],this.questions[t].subQuestions[e][i]=n,"score"==i&&(this.totalScore=(this.totalScore-v()(a)+v()(n)).toFixed(1),this.trigger("updateQuestionScore",[r])),this.flag=!1)}},{key:"deleteSubQuestion",value:function(t,e){var i;this.isUpdating()&&(this.flag=!0,i=this.questions[t].subQuestions[e],this.questions[t].subQuestions.splice(e,1),this.totalScore=(v()(this.totalScore)-v()(i.score)).toFixed(1),this.correctMaterialQuestion(t),this.trigger("updateQuestionScore"),this.flag=!1)}},{key:"correctQuestion",value:function(t){var e=this.questions[t];void 0!==e.errors&&("material"===e.type&&void 0!==e.errors.hasSubError?e.errors={hasSubError:!0}:delete e.errors,void 0===(this.questions[t]=e).errors&&this.trigger("correctQuestion",[t]))}},{key:"correctSubQuestion",value:function(t,e){var i=this.questions[t],n=i.subQuestions[e];void 0!==n.errors&&(delete n.errors,i.subQuestions[e]=n,this.questions[t]=i,this.correctMaterialQuestion(t))}},{key:"correctMaterialQuestion",value:function(t){var e=this.questions[t],i=!1;$.each(e.subQuestions,function(t,e){void 0!==e.errors&&(i=!0)}),i||void 0===e.errors||delete e.errors.hasSubError,$.isEmptyObject(e.errors)&&(delete e.errors,this.trigger("correctQuestion",[t])),this.questions[t]=e}},{key:"isUpdating",value:function(){return!0!==this.flag||(cd.message({type:"danger",message:Translator.trans("course.question.is_updating_hint")}),!1)}},{key:"_toJson",value:function(t){var e={};return t&&(e=$.parseJSON(t.replace(/[\r\n\t]/g,""))),e}},{key:"on",value:function(t,e){this.eventManager[t]?this.eventManager[t].push(e.bind(this)):this.eventManager[t]=[e.bind(this)]}},{key:"trigger",value:function(t,e){this.eventManager[t]&&this.eventManager[t].map(function(t){t.apply(null,e)})}},{key:"_random",value:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)}},{key:"_getToken",value:function(){return this._random()+this._random()+"-"+this._random()+"-"+this._random()+"-"+this._random()+"-"+this._random()+this._random()+this._random()}}]),t}(),S=i(90),Q=function(){function i(t,e){T()(this,i),this.$form=t,this.operate=e,this.titleFieldId="question-stem-field",this.$analysisModal=$(".js-analysis-modal"),this.validator=null,this.titleEditorToolBarName="Minimal",this.analysisEditor=null,this._init(),this.attachmentActions=new S.a(t)}return q()(i,[{key:"_init",value:function(){this._initEvent(),this._initValidate(),this._initAnalysisEditor(),this._initSelect()}},{key:"_initEvent",value:function(){var e=this;this.$form.on("click",".js-finish-edit",function(t){return e.submitForm(t)}),this.$form.on("click",".js-analysis-edit",function(t){return e.showAnalysisModal(t)}),this.$analysisModal.on("click",".js-analysis-btn",function(t){return e.saveAnalysis(t)}),$('[data-toggle="tooltip"]').tooltip()}},{key:"_initSelect",value:function(){$("[name=categoryId]").select2({treeview:!0,dropdownAutoWidth:!0,treeviewInitState:"collapsed",placeholderOption:"first"})}},{key:"_initTooltip",value:function(){$("[data-toggle=tooltip]").tooltip()}},{key:"submitForm",value:function(t){var e;this.validator.form()&&($(t.currentTarget).button("loading"),e=this.getQuestion(),this.finishEdit(e),this.changeBottomFixed())}},{key:"changeBottomFixed",value:function(){var t,e=k()(window.scrollY+document.documentElement.clientHeight),i=0;$(".es-footer-link").length?i=k()($(".es-footer-link").offset().top):$(".es-footer").length&&(i=k()($(".es-footer").offset().top)),i?i<e&&$(".js-subject-item-btn").removeClass("subject-bottom-fixed"):(t=k()($(document).scrollTop()),k()($(document.body).height())-560<=t+k()($(window).height())&&$(".js-subject-item-btn").removeClass("subject-bottom-fixed"))}},{key:"_initAnalysisEditor",value:function(){var t=this,e=this.$form.find('[data-edit="analysis"]').val(),i=$(".js-analysis-field");CKEDITOR.instances[i.attr("id")]&&CKEDITOR.instances[i.attr("id")].destroy(),i.val(e),this.analysisEditor=CKEDITOR.replace(i.attr("id"),{toolbar:this.titleEditorToolBarName,fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:i.data("imageUploadUrl"),height:i.height()}),this.analysisEditor.on("change",function(){i.val(t.analysisEditor.getData())}),this.analysisEditor.on("blur",function(){i.val(t.analysisEditor.getData())})}},{key:"showAnalysisModal",value:function(t){var e=$(t.currentTarget).prev('[data-edit="analysis"]').val();this.analysisEditor.setData(e),this.$analysisModal.modal("show")}},{key:"saveAnalysis",value:function(){var t=this.analysisEditor.getData();$('[data-edit="analysis"]').val(t),$(".js-analysis-content").html($(this.replacePicture(t)).text()),this.$analysisModal.modal("hide")}},{key:"finishEdit",value:function(t){var e=this,i=$(".js-hidden-token").val(),n=$(".js-hidden-method").val(),s=$(".js-sub-judge").val(),a=$(".js-edit-form-seq").text()-1,r=0,r="1"==s?(i=e.updateCachedSubQuestion(i,a,t,n),t=e.operate.getSubQuestion(i,a),1+a):(i=e.updateCachedQuestion(i,t,n),t=e.operate.getQuestion(i),e.operate.getQuestionOrder(i));this.analysisEditor.destroy(),$.post(e.$form.data("url"),{seq:r,question:t,token:i,isSub:s},function(t){e.$form.parent(".subject-item").replaceWith(t),e._initTooltip()})}},{key:"updateCachedQuestion",value:function(i,t,e){var n=this;return"add"==e?i=n.operate.addQuestion(i,t):($.each(t,function(t,e){n.operate.updateQuestionItem(i,t,e)}),n.operate.correctQuestion(i)),i}},{key:"updateCachedSubQuestion",value:function(i,n,t,e){var s=this;return"add"==e?i=s.operate.addSubQuestion(i,t):($.each(t,function(t,e){s.operate.updateSubQuestionItem(i,n,t,e)}),s.operate.correctSubQuestion(i,n)),i}},{key:"getQuestion",value:function(){var i={};return $("*[data-edit]").each(function(){var t=$(this).data("edit"),e=$(this).val();i[t]=e}),i.difficulty=$("input[name='difficulty']:checked").val(),i.attachment=this.getAttachments(),i=this.filterQuestion(i)}},{key:"filterQuestion",value:function(t){return t}},{key:"getAttachments",value:function(){var t={};return 0<$(".js-attachment-list-stem").find(".js-attachment-name").length&&(t.stem={type:"attachment",targetType:"question.stem",fileIds:$(".js-attachment-ids-stem").val(),fileName:$(".js-attachment-list-stem").find(".js-attachment-name").text()}),0<$(".js-attachment-list-analysis").find(".js-attachment-name").length&&(t.analysis={type:"attachment",targetType:"question.analysis",fileIds:$(".js-attachment-ids-analysis").val(),fileName:$(".js-attachment-list-analysis").find(".js-attachment-name").text()}),t}},{key:"_initValidate",value:function(){var t=this.$form.validate({onkeyup:!1,rules:{difficulty:{required:!0},stem:{required:!0},score:{required:!0,number:!0,max:999,min:0,es_score:!0}},messages:{difficulty:Translator.trans("course.question.create.difficulty_required_error_hint"),stem:{required:Translator.trans("subject.stem_required")}}});this.validator=t}},{key:"initTitleEditor",value:function(){var t=this,e=$("#"+t.titleFieldId),i=e.prev(),n=CKEDITOR.replace(t.titleFieldId,{toolbar:t.titleEditorToolBarName,fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:e.data("imageUploadUrl"),height:e.height()});n.on("change",function(){e.val(n.getData()),i.val($(t.replacePicture(n.getData())).text())}),n.on("blur",function(){e.val(n.getData()),i.val($(t.replacePicture(n.getData())).text())}),n.on("instanceReady",function(){this.focus(),$('[data-role="edit"]').one("click",function(){i.val($(t.replacePicture(n.getData())).text()),e.val(n.getData()),n.destroy(),e.hide(),i.show()})})}},{key:"replacePicture",value:function(t){return t.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/gi,"[".concat(Translator.trans("subject.symbol.picture"),"]"))}},{key:"titleEditorToolBarName",set:function(t){this._titleEditorToolBarName=t},get:function(){return this._titleEditorToolBarName}}]),i}(),C=i(2),O=i.n(C),I=i(8),E=i.n(I),M=i(9),D=i.n(M),F=i(5),L=i.n(F);function B(n){var s=function(){if("undefined"==typeof Reflect||!O.a)return!1;if(O.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(O()(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e,i=L()(n);return e=s?(t=L()(this).constructor,O()(i,arguments,t)):i.apply(this,arguments),D()(this,e)}}var A=function(t){E()(s,t);var n=B(s);function s(t,e){var i;return T()(this,s),(i=n.call(this,t,e)).validator=null,i.oldFieldId="question-stem-field",i.fieldId="",i.optionCount=0,i.timer=!1,i.errorMessage={noAnswer:Translator.trans("subject.choice_answer_least_two")},i.init(),i}return q()(s,[{key:"init",value:function(){this.initTitleEditor(this.validator),this.initOptionCount(),this.initData(),this.initEvent(),this.initValidator()}},{key:"initOptionCount",value:function(){this.optionCount=$(".edit-subject-item").length}},{key:"initEvent",value:function(){var e=this;this.$form.on("focus",".js-item-option-edit",function(t){return e.editOption(t)}),this.$form.on("click",".js-item-option-delete",function(t){return e.deleteOption(t)}),this.$form.on("click",".js-item-option-add",function(t){return e.addOption(t)}),this.$form.on("click",'[data-role="edit"]',function(t){return e.editOption(t)})}},{key:"initData",value:function(){$(".cd-checkbox.checked").find('[name="right"]').attr("checked",!0)}},{key:"initValidator",value:function(){$.validator&&($.validator.prototype.elements=function(){var t=this,e={};return $(this.currentForm).find("input, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&t.settings.debug&&window.console&&console.error("%o has no name assigned",this),e[this.name]=!0})},$.validator.addMethod("noMoreThan",function(t,e,i){return""==t||v()(t)<=v()($(i).val())},"Please enter a lesser value."),$.validator.addMethod("multi",function(t,e,i){return 1<$('input:checkbox[name="right"]:checked').length}));var n=this;this.$form.validate().destroy(),this.validator=this.$form.validate({onkeyup:!1,rules:{score:{required:!0,max:999,min:0,es_score:!0},missScore:{required:!1,max:999,min:0,noMoreThan:'[name="score"]',es_score:!0},stem:{required:!0},options:{required:!0},right:{required:!0,multi:!0}},messages:{missScore:{noMoreThan:Translator.trans("subject.miss_score_no_more_than_score")},stem:{required:Translator.trans("subject.validate.stem_required")},options:{required:Translator.trans("subject.validate.option_required")}},errorPlacement:function(t,e){var i=e.attr("name");"right"==i?($(".edit-subject-item__order").addClass("edit-subject-item__order--error"),cd.message({type:"danger",message:n.errorMessage.noAnswer})):"stem"==i?$("#cke_question-stem-field").after(t):"options"==i&&e.prev().hasClass("hidden")?t.appendTo(e.parent()):t.insertAfter(e)}})}},{key:"editOption",value:function(t){var e=this,i=$(t.currentTarget),n=i.next();this.fieldId=n.attr("id"),i.addClass("hidden");var s,a=$("#"+this.fieldId),r=null;CKEDITOR.instances[this.oldFieldId]&&(r=CKEDITOR.instances[this.oldFieldId],(s=$("#"+this.oldFieldId)).addClass("hidden"),s.prevAll("input").first().removeClass("hidden").show().val($(e.replacePicture(r.getData())).text()),CKEDITOR.instances[this.oldFieldId].destroy()),this.oldFieldId=this.fieldId,CKEDITOR.instances[this.fieldId]&&CKEDITOR.instances[this.fieldId].destroy(),(r=CKEDITOR.replace(this.fieldId,{toolbar:"Minimal",fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:a.data("imageUploadUrl"),height:a.height(),startupFocus:!0})).focus(),r.on("change",function(){a.val(r.getData()),a.prev("input").val($(e.replacePicture(r.getData())).text())}),r.on("blur",function(){a.val(r.getData()),a.prev("input").val($(e.replacePicture(r.getData())).text())})}},{key:"deleteOption",value:function(t){var e,i,n;this.optionCount<=2?cd.message({type:"danger",message:Translator.trans("subject.choice_option_least_two")}):(e=$(t.currentTarget).parents(".edit-subject-item"),i=e.find(".edit-subject-item__order").text(),n=e.find('input[name="right"]').val(),e.nextAll(".edit-subject-item").each(function(){var t=$(this).find(".edit-subject-item__order"),e=t.text();t.text(i),i=e,$(this).find('input[name="right"]').val(n),n++}),e.remove(),this.optionCount--)}},{key:"addOption",value:function(t){var e=this;e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){e.addRealOperate(t)},500)}},{key:"addRealOperate",value:function(e){var i=this,t=$(e.currentTarget);if(10<=this.optionCount)return cd.message({type:"danger",message:Translator.trans("subject.choice_option_most_ten")}),void t.attr("disabled",!1);var n=$('[name="type"]').val();$.ajax({url:"/subject/option/".concat(n),type:"get",data:{order:this.optionCount}}).done(function(t){$(e.currentTarget).parent().before(t),i.optionCount++})}},{key:"submitForm",value:function(t){this.optionCount<2?cd.message({type:"danger",message:Translator.trans("subject.choice_option_least_two")}):(this.validator.resetForm(),this.validator.form()&&($(t.currentTarget).button("loading"),this.finishEdit(this.$form.serializeArray())))}},{key:"finishEdit",value:function(t){var e=$(".js-hidden-token").val(),i=this,s={options:[],answers:[]};$.each(t,function(t,e){var i=e.name,n=e.value;-1!==$.inArray(i,["stem","difficulty","score","missScore","type","analysis","categoryId"])?s[i]=n:"options"==i?s.options.push(n):"right"==i&&s.answers.push(n)}),s.attachment=this.getAttachments();var n=$(".js-hidden-method").val(),a=$(".js-sub-judge").val(),r=$(".js-edit-form-seq").text()-1,o=0,o="1"==a?(e=i.updateCachedSubQuestion(e,r,s,n),s=i.operate.getSubQuestion(e,r),1+r):(e=i.updateCachedQuestion(e,s,n),s=i.operate.getQuestion(e),i.operate.getQuestionOrder(e));this.analysisEditor.destroy(),$.post(i.$form.data("url"),{seq:o,question:s,token:e,isSub:a},function(t){i.$form.parent(".subject-item").replaceWith(t),i._initTooltip()})}}]),s}(Q),P=i(291),R=i.n(P);function U(n){var s=function(){if("undefined"==typeof Reflect||!O.a)return!1;if(O.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(O()(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e,i=L()(n);return e=s?(t=L()(this).constructor,O()(i,arguments,t)):i.apply(this,arguments),D()(this,e)}}var N=function(t){E()(s,t);var n=U(s);function s(t,e){var i;return T()(this,s),(i=n.call(this,t,e)).errorMessage={noAnswer:Translator.trans("subject.choice_require_answer")},i}return q()(s,[{key:"initEvent",value:function(){var e=this;R()(L()(s.prototype),"initEvent",this).call(this),this.$form.on("change",'input:radio[name="right"]',function(t){return e.changeRadio(t)})}},{key:"initData",value:function(){R()(L()(s.prototype),"initData",this).call(this);var t=this.$form.find(".js-choose-item");$(".cd-radio.checked").find('[name="right"]').attr("checked",!0),this.checkedRadio=t.find(".cd-radio.checked")}},{key:"initValidator",value:function(){R()(L()(s.prototype),"initValidator",this).call(this),$.validator.addMethod("multi",function(t,e,i){return!0})}},{key:"changeRadio",value:function(t){this.checkedRadio&&this.checkedRadio.removeClass("checked"),this.checkedRadio=$(t.currentTarget).parent()}}]),s}(A);function V(n){var s=function(){if("undefined"==typeof Reflect||!O.a)return!1;if(O.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(O()(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e,i=L()(n);return e=s?(t=L()(this).constructor,O()(i,arguments,t)):i.apply(this,arguments),D()(this,e)}}var z=function(t){E()(s,t);var n=V(s);function s(t,e){var i;return T()(this,s),(i=n.call(this,t,e)).errorMessage={noAnswer:Translator.trans("subject.choice_require_answer")},i}return q()(s,[{key:"initValidator",value:function(){R()(L()(s.prototype),"initValidator",this).call(this),$.validator.addMethod("multi",function(t,e,i){return!0})}}]),s}(A);function K(n){var s=function(){if("undefined"==typeof Reflect||!O.a)return!1;if(O.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(O()(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e,i=L()(n);return e=s?(t=L()(this).constructor,O()(i,arguments,t)):i.apply(this,arguments),D()(this,e)}}var J=function(t){E()(s,t);var n=K(s);function s(t,e){var i;return T()(this,s),(i=n.call(this,t,e)).initTitleEditor(i.validator),i.$answerField=$('[name="answer"]'),i.init(),i}return q()(s,[{key:"init",value:function(){this.$answerField.rules("add",{required:!0,messages:{required:Translator.trans("course.question.create.right_answer_required_error_hint")}})}},{key:"filterQuestion",value:function(t){var e=$("input[name='answer']:checked").val();return t.answer="true"==e,t}}]),s}(Q);function W(n){var s=function(){if("undefined"==typeof Reflect||!O.a)return!1;if(O.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(O()(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e,i=L()(n);return e=s?(t=L()(this).constructor,O()(i,arguments,t)):i.apply(this,arguments),D()(this,e)}}jQuery.validator.addMethod("fillCheck",function(t,e){return this.optional(e)||/(\[\[(.+?)\]\])/i.test(t)},Translator.trans("course.question.create.fill_hint"));var H=function(t){E()(s,t);var n=W(s);function s(t,e){var i;return T()(this,s),(i=n.call(this,t,e)).titleEditorToolBarName="Question",i.initTitleEditor(i.validator),i.$titleField=$("#"+i.titleFieldId),i.init(),i}return q()(s,[{key:"init",value:function(){this.$titleField.rules("add",{fillCheck:!0})}},{key:"filterQuestion",value:function(t){var e=t.stem.match(/\[\[(.+?)\]\]/g);if(null!=e){t.answers=[];for(var i=0;i<e.length;i++){var n=(n=e[i].substring(2)).substring(0,n.length-2);t.answers.push(n)}}return t}}]),s}(Q);function Y(n){var s=function(){if("undefined"==typeof Reflect||!O.a)return!1;if(O.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(O()(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e,i=L()(n);return e=s?(t=L()(this).constructor,O()(i,arguments,t)):i.apply(this,arguments),D()(this,e)}}var G=function(t){E()(s,t);var n=Y(s);function s(t,e){var i;return T()(this,s),(i=n.call(this,t,e)).initTitleEditor(i.validator),i.answerFieldId="question-answer-field",i.$answerField=$("#"+i.answerFieldId),i.init(),i}return q()(s,[{key:"init",value:function(){var e=this;this.$answerField.rules("add",{required:!0,messages:{required:Translator.trans("subject.essay_require_answer")}}),this.$form.on("click",'[data-role="edit"]',function(t){return e.answerClick(t)})}},{key:"answerClick",value:function(t){var e=this,i=$(t.currentTarget),n=i.next();i.hide();var s=CKEDITOR.replace(n.attr("id"),{toolbar:"Minimal",fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:n.data("imageUploadUrl"),height:n.height()});s.on("change",function(){n.val(s.getData()),i.val($(e.replacePicture(s.getData())).text())}),s.on("blur",function(){n.val(s.getData()),i.val($(e.replacePicture(s.getData())).text())}),s.on("instanceReady",function(){this.focus(),$('[data-role="edit"]').one("click",function(){i.val($(e.replacePicture(s.getData())).text()),n.val(s.getData()),s.destroy(),n.hide(),i.show()})})}}]),s}(Q);function X(n){var s=function(){if("undefined"==typeof Reflect||!O.a)return!1;if(O.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(O()(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e,i=L()(n);return e=s?(t=L()(this).constructor,O()(i,arguments,t)):i.apply(this,arguments),D()(this,e)}}var Z=function(t){E()(s,t);var n=X(s);function s(t,e){var i;return T()(this,s),(i=n.call(this,t,e)).initTitleEditor(i.validator),i}return s}(Q),tt=function(){function t(){T()(this,t)}return q()(t,null,[{key:"getEditor",value:function(t,e,i){switch(t){case"single_choice":new N(e,i);break;case"uncertain_choice":new z(e,i);break;case"choice":new A(e,i);break;case"determine":new J(e,i);break;case"essay":new G(e,i);break;case"fill":new H(e,i);break;case"material":new Z(e,i);break;default:new Q(e,i).initTitleEditor()}}}]),t}(),et=i(139);function it(t,e){var i;if(void 0===d.a||null==t[l.a]){if(c()(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return nt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return h()(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return nt(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,o=!1;return{s:function(){i=u()(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){o=!0,a=t},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw a}}}}function nt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var st=function(){function m(){T()(this,m),this.$element=$(".js-subject-list"),this.$itemList=$(".js-item-list"),this.$subjectData=$(".js-subject-data"),this.$batchBtn=$(".js-batch-btn"),this.$allBtn=$(".js-batch-select"),this.flag=!0,this.$diffiultyModal=$(".js-difficulty-modal"),this.$scoreModal=$(".js-score-modal"),this.$categoryModal=$(".js-category-modal"),this.scoreValidator=null,this.selectQuestion=[],this.questionOperate=null,this.testpaperTitle="",this.redirect=!1,this.questionOperate=null,this.timer=!1,this.questionBankId=$("#questionBankId").val(),this.init()}return q()(m,[{key:"init",value:function(){this.initQuestionOperate(),this.confirmFresh(),this.sbListFixed(),this.footerButtonFixed(),this.initEvent(),this.initScoreValidator(),this.setDifficulty(),this.initTestpaperTitle(),this.itemClick(),this.statErrorQuestions(),this.ieImg(),this.initSelect(),this.initTooltip()}},{key:"initQuestionOperate",value:function(){var s=this;s.questionOperate=new w,s.questionOperate.on("correctQuestion",function(t){$('[data-anchor="#'.concat(t,'"]')).hasClass("subject-list-item__num--error")&&($('[data-anchor="#'.concat(t,'"]')).removeClass("subject-list-item__num--error"),s.statErrorQuestions())}),s.questionOperate.on("addQuestion",function(t,e,i){$('[data-anchor="#'.concat(t,'"]')).attr("data-anchor","#"+e),s.updateTotalScoreText(),s.updateQuestionCountText(i)}),s.questionOperate.on("deleteQuestion",function(t){s.updateTotalScoreText(),s.updateQuestionCountText(t)}),s.questionOperate.on("updateQuestionScore",function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];s.updateTotalScoreText(t)}),s.questionOperate.on("updateQuestionType",function(t,e,i,n){s.updateQuestionCountText(e),s.updateQuestionCountText(i),s.questionTypeConvert(e,n)})}},{key:"initSelect",value:function(){$("[name=categoryId]").select2({treeview:!0,dropdownAutoWidth:!0,treeviewInitState:"collapsed",placeholderOption:"first"})}},{key:"initTooltip",value:function(){$("[data-toggle=tooltip]").tooltip()}},{key:"confirmFresh",value:function(){var t=this;$(window).on("beforeunload",function(){if(!t.redirect)return Translator.trans("admin.block.not_saved_data_hint")})}},{key:"initEvent",value:function(){var e=this;this.$element.on("click",".js-batch-select",function(t){return e.batchToItem(t)}),this.$element.on("click",".js-show-checkbox",function(t){return e.itemToBatch(t)}),this.$element.on("click",".js-batch-btn",function(t){return e.batchBtnClick(t)}),this.$element.on("click",".js-finish-btn",function(t){return e.finishBtnClick(t)}),this.$element.on("click","*[data-anchor]",function(t){return e.quickToQuestion(t,e.flag)}),this.$element.on("click",".js-difficult-setting",function(t){return e.showModal(t,e.$diffiultyModal)}),this.$element.on("click",".js-category-setting",function(t){return e.showModal(t,e.$categoryModal)}),this.$element.on("click",".js-score-setting",function(t){return e.showScoreModal(t)}),this.$scoreModal.on("click",".js-batch-score-confirm",function(t){return e.batchSetScore(t)}),this.$categoryModal.on("click",".js-batch-set-category",function(t){return e.batchSetCategory(t)}),this.$itemList.on("click",".js-item-edit",function(t){return e.itemEdit(t)}),this.$itemList.on("click",".js-item-delete",function(t){return e.deleteSubjectItem(t)}),this.$itemList.on("change",".js-testpaper-title",function(t){return e.editTestpaperTitle(t)}),this.$itemList.on("click",".js-import-btn",function(t){return e.finishImport(t)})}},{key:"initTestpaperTitle",value:function(){var i=this;this.isTestpaper()&&(this.testpaperTitle=$(".js-testpaper-title").val()),this.$itemList.on("click",".subject-change-btn",function(t){return i.itemConvert(t)}),this.$itemList.on("click",".js-item-add",function(t){return i.addModalShow(t,!1)}),this.$itemList.on("click",".js-item-add-sub",function(t){return i.addModalShow(t,!0)}),this.$subjectData.bind("change","*[data-type]",function(t,e){return i.updateQuestionCountText(e)}),this.$subjectData.bind("change",".js-total-score",function(t){return i.updateTotalScoreText()})}},{key:"sbListFixed",value:function(){var e,i,n=$(".js-subject-data").width();this.$element.length&&(i=(e=this).$element.offset().top,$(window).scroll(function(t){e.$element.width(n),$(window).scrollTop()>=i?e.$element.addClass("sb-fixed"):e.$element.removeClass("sb-fixed")}))}},{key:"footerButtonFixed",value:function(){window.addEventListener("scroll",Object(et.a)(this.scrollBottom,100,!0))}},{key:"scrollBottom",value:function(){var a=$(".js-subject-item-btn");$(window).scroll(function(t){var e,i,n=k()(window.scrollY+document.documentElement.clientHeight),s=0;$(".es-footer-link").length?s=k()($(".es-footer-link").offset().top):$(".es-footer").length&&(s=k()($(".es-footer").offset().top)),s?n<s?a.addClass("subject-bottom-fixed"):a.removeClass("subject-bottom-fixed"):(e=k()($(document).scrollTop()),i=k()($(document.body).height()),e+k()($(window).height())<i-560?a.addClass("subject-bottom-fixed"):a.removeClass("subject-bottom-fixed"))})}},{key:"batchToItem",value:function(t){t.currentTarget===t.target&&($(t.currentTarget).hasClass("checked")?this.$element.find(".js-show-checkbox").removeClass("checked"):this.$element.find(".js-show-checkbox").addClass("checked"))}},{key:"itemToBatch",value:function(t){t.currentTarget===t.target&&this.countNumber()}},{key:"countNumber",value:function(){var e=this.$element.find(".js-show-checkbox").length,i=this;setTimeout(function(){var t=$(".js-subject-list-body").find(".checked").length;e===t?i.$allBtn.addClass("checked"):i.$allBtn.removeClass("checked")},100)}},{key:"batchBtnClick",value:function(t){this.isEditing()||($(t.target).toggleClass("hidden"),this.toggleClass(!0),this.flag=!1)}},{key:"finishBtnClick",value:function(){this.$element.find(".js-show-checkbox").removeClass("checked"),this.$allBtn.removeClass("checked"),this.$batchBtn.toggleClass("hidden"),this.toggleClass(!1),this.flag=!0}},{key:"toggleClass",value:function(t){t?(this.$element.find(".js-subject-wrap").removeClass("hidden"),this.$element.find(".js-show-checkbox").removeClass("hidden")):(this.$element.find(".js-subject-wrap").addClass("hidden"),this.$element.find(".js-show-checkbox").addClass("hidden"))}},{key:"quickToQuestion",value:function(t,e){var i,n=$(t.currentTarget);e?(i=$(n.attr("data-anchor")).offset(),$(document).scrollTop(i.top)):(n.find(".js-show-checkbox").toggleClass("checked"),this.countNumber())}},{key:"showModal",value:function(t,e){var i,n;this.isEditing()||(i=this.statChosedQuestion(),0!==y()(i).length?(n="",$.each(i,function(t,e){var i=e.count+Translator.trans("subject.question_unit")+e.name+Translator.trans("subject.comma");n+=i}),n=n.substring(0,n.length-1)+Translator.trans("subject.period"),e.find(".js-select").html(n),e.modal("show")):cd.message({type:"danger",message:Translator.trans("subject.select_question_hint")}))}},{key:"showScoreModal",value:function(t){var e,i;this.isEditing()||(e=this.statChosedQuestion(),i=$(".js-miss-score-field"),this.isTestpaper()&&(e.hasOwnProperty("choice")||e.hasOwnProperty("uncertain_choice"))?i.removeClass("hidden"):i.addClass("hidden"),null!=this.scoreValidator&&this.scoreValidator.resetForm(),this.$scoreModal.find("input").each(function(){$(this).val("")}),this.showModal(t,this.$scoreModal))}},{key:"statChosedQuestion",value:function(){var n={},s=this;return s.$element.find(".js-show-checkbox.checked").each(function(){var t=$(this).data("type"),e=$(this).parent().next(".js-type-name").text(),i=$(this).parents(".js-subject-anchor").data("anchor");void 0===n[t]?n[t]={name:e,count:1}:n[t].count++,s.selectQuestion.push(i.substr(1))}),n}},{key:"initScoreValidator",value:function(){this.scoreValidator=$("#batch-set-score-form").validate({onkeyup:!1,rules:{score:{required:!0,max:999,min:0,es_score:!0},missScore:{required:!1,max:999,min:0,noMoreThan:"#score",es_score:!0}},messages:{missScore:{noMoreThan:Translator.trans("subject.miss_score_no_more_than_score")}}}),$.validator.addMethod("noMoreThan",function(t,e,i){return""==t||v()(t)<=v()($(i).val())},"Please enter a lesser value.")}},{key:"isTestpaper",value:function(){return 1==$('input[name="isTestpaper"]').val()}},{key:"batchSetScore",value:function(){var t;this.scoreValidator.form()&&(t={score:this.$scoreModal.find('input[name="score"]').val(),missScore:this.$scoreModal.find('input[name="missScore"]').val()},this.questionOperate.modifyScore(this.selectQuestion,t,this.isTestpaper()),this.selectQuestion=[],cd.message({type:"success",message:Translator.trans("subject.score_update_success")}),this.$scoreModal.modal("hide"))}},{key:"batchSetCategory",value:function(){var t=this.$categoryModal.find("#categoryId").val(),e=this.$categoryModal.find("#categoryId").find("option:selected").text();this.questionOperate.modifyCategory(this.selectQuestion,t,$.trim(e)),this.selectQuestion=[],cd.message({type:"success",message:Translator.trans("subject.category_update_success")}),this.$categoryModal.modal("hide")}},{key:"setDifficulty",value:function(){var i=this;$(".js-difficulty-btn").click(function(){var t=$("input[name='difficultyRadios']:checked").val(),e=$("input[name='difficultyRadios']:checked").next().text();i.questionOperate.modifyDifficulty(i.selectQuestion,t,e),i.selectQuestion=[],cd.message({type:"success",message:Translator.trans("subject.difficulty_update_success")}),i.$diffiultyModal.modal("hide")})}},{key:"itemEdit",value:function(t){var e,i,n,s,a,r,o,u,c;this.isEditing()||(e=this,n="",s={},a=i=0,r=$(t.currentTarget),o=r.parents(".subject-item"),u=r.parents(".subject-item__operation").data("url"),void 0!==o.attr("data-material-token")?(i=o.data("key"),n=o.attr("data-material-token"),s=this.questionOperate.getSubQuestion(n,i),a=1,i++):(i=this.questionOperate.getQuestionOrder(o.attr("id")),s=this.questionOperate.getQuestion(o.attr("id")),n=o.attr("id")),c={seq:i,token:n,question:s,isSub:a,method:"edit",isTestpaper:this.isTestpaper()?1:0,questionBankId:this.questionBankId},$.post(u,c,function(t){o.replaceWith(t),tt.getEditor(s.type,$(".js-edit-form"),e.questionOperate),e.initSelect()}))}},{key:"itemConvert",value:function(t){var e,i=$(t.currentTarget),n=i.parents(".subject-item"),s=i.data("type"),a=i.parents(".subject-change-list").data("fromType"),r=i.parents(".js-edit-form"),o=i.parents(".subject-change-list").data("convertUrl"),u=m._serializeArrayConvertToJson(r.serializeArray());0<$(".js-attachment-list").length&&(e={},0<$(".js-attachment-list-stem").find(".js-attachment-name").length&&(e.stem={type:"attachment",targetType:"question.stem",fileIds:$(".js-attachment-ids-stem").val(),fileName:$(".js-attachment-list-stem").find(".js-attachment-name").text()}),0<$(".js-attachment-list-analysis").find(".js-attachment-name").length&&(e.analysis={type:"attachment",targetType:"question.analysis",fileIds:$(".js-attachment-ids-analysis").val(),fileName:$(".js-attachment-list-analysis").find(".js-attachment-name").text()}),u.attachment=e);var c=$(".js-edit-form-seq").text(),l=$(".js-sub-judge").val(),d=$(".js-hidden-method").val(),h={seq:c,token:u.token,question:u,fromType:a,toType:s,isSub:l,method:d,isTestpaper:this.isTestpaper()?1:0,questionBankId:this.questionBankId};h.fromType=a,h.toType=s;var f=this;$.post(o,h,function(t){n.replaceWith(t),tt.getEditor(s,$(".js-edit-form"),f.questionOperate)})}},{key:"itemClick",value:function(){var r=this;$(".js-create-btn").on("click",function(t){var a=$(t.target);r.timer&&clearTimeout(r.timer),r.timer=setTimeout(function(){a.attr("disabled",!0);var t=$("#cd-modal"),e=t.attr("data-sub"),i=a.data("url"),n=t.attr("data-index"),s=a.data("type");"false"==e?r.itemAdd(n,s,i,a):r.subItemAdd(n,s,i)},500)})}},{key:"itemAdd",value:function(i,n,t,s){var a=this,r=a.questionOperate.getQuestionOrder(i)+1,e=this.isTestpaper()?1:0,o={seq:r,token:i,method:"add",isTestpaper:e,questionBankId:this.questionBankId};$.post(t,o).then(function(t){$("#cd-modal").modal("hide"),$(".js-create-btn").attr("disabled",!1);var e=r+1;a.orderQuestionList(e,$('[data-anchor="#'.concat(i,'"]')).parent(),$("#".concat(i))),$('[data-anchor="#'.concat(i,'"]')).parent().after(a.getNewListItem(r,n,s.text())),a.statErrorQuestions(),$("#".concat(i)).next(".subject-item").hasClass("subject-sub-item")?$('[data-material-token="'.concat(i,'"]')).last().after(t):$("#".concat(i)).after(t),tt.getEditor(n,$(".js-edit-form"),a.questionOperate)})}},{key:"subItemAdd",value:function(e,i,t){var n=this,s=this.questionOperate.getQuestion(e).subQuestions.length+1,a=this.isTestpaper()?1:0,r={seq:s,token:e,method:"add",isSub:1,isTestpaper:a,questionBankId:this.questionBankId};$.post(t,r).then(function(t){$("#cd-modal").modal("hide"),$(".js-create-btn").attr("disabled",!1),$("#".concat(e)).next(".subject-item").hasClass("subject-sub-item")?$('[data-material-token="'.concat(e,'"]')).last().after(t):$("#".concat(e)).after(t),tt.getEditor(i,$(".js-edit-form"),n.questionOperate)})}},{key:"getNewListItem",value:function(t,e,i){return"material"!==e?'<div class="col-sm-3 subject-list-item js-subject-list-item">\n          <div class="subject-list-item__num  js-subject-anchor" data-anchor="#'.concat(t,'">\n            <span class="js-list-index">').concat(t,'</span>\n            <label class="sb-checkbox cd-checkbox js-show-checkbox hidden" data-type="').concat(e,'"><input type="checkbox" data-toggle="cd-checkbox"></label>\n          </div>\n          <span class="js-type-name">').concat(i,"</span>\n        </div>"):'<div class="col-sm-3 subject-list-item js-subject-list-item">\n          <div class="subject-list-item__num  js-subject-anchor" data-anchor="#'.concat(t,'">\n            <span class="js-list-index">').concat(t,'</span>\n          </div>\n          <span class="js-type-name">').concat(i,"</span>\n        </div>")}},{key:"deleteSubjectItem",value:function(u){var c=this;this.isEditing()||(this.questionOperate.getTokenList().length<2?cd.message({type:"danger",message:Translator.trans("subject.question_delete_tip")}):cd.confirm({title:Translator.trans("subject.delete.title"),content:Translator.trans("subject.delete.content"),okText:Translator.trans("site.confirm"),cancelText:Translator.trans("site.cancel")}).on("ok",function(){var t,e,i,n,s,a,r=$(u.currentTarget).parent().parent(),o=r.attr("id");r.hasClass("subject-sub-item")?(o=r.attr("data-material-token"),t=r.attr("data-key"),c.questionOperate.deleteSubQuestion(o,t),r.remove(),c.changeBottomFixed(),e=0,$('[data-material-token="'.concat(o,'"]')).each(function(){$(this).attr("id","sub".concat(e)),$(this).attr("data-key",e++),$(this).find(".subject-sub-item__number").text("(".concat(e,")"))})):(i=c.questionOperate.getQuestion(o),n=c.questionOperate.getQuestionOrder(o),s=$("[data-anchor=#".concat(o,"]")).parent(),c.orderQuestionList(n,s,r),c.questionOperate.deleteQuestion(o),a=c,"material"===i.type&&r.nextUntil(".js-subject-main-item").each(function(){$(this).remove(),a.changeBottomFixed()}),s.remove(),r.remove(),a.changeBottomFixed(),c.statErrorQuestions())}))}},{key:"changeBottomFixed",value:function(){var t,e=k()(window.scrollY+document.documentElement.clientHeight),i=0;$(".es-footer-link").length?i=k()($(".es-footer-link").offset().top):$(".es-footer").length&&(i=k()($(".es-footer").offset().top)),i?i<e&&$(".js-subject-item-btn").removeClass("subject-bottom-fixed"):(t=k()($(document).scrollTop()),k()($(document.body).height())-560<=t+k()($(window).height())&&$(".js-subject-item-btn").removeClass("subject-bottom-fixed"))}},{key:"editTestpaperTitle",value:function(t){var e=$(t.target).val();if(""===$.trim(e))return cd.message({type:"danger",message:Translator.trans("subject.testpaper_title_empty_hint")}),void $(t.target).val(this.testpaperTitle);for(var i=e.length,n=0;n<e.length;n++)127<e.charCodeAt(n)&&i++;if(50<i)return cd.message({type:"danger",message:Translator.trans("subject.testpaper_title_too_long_hint")}),void $(t.target).val(this.testpaperTitle);this.testpaperTitle=e}},{key:"updateQuestionCountText",value:function(t){var e=this.questionOperate.getQuestionCount("total"),i=this.questionOperate.getQuestionCount(t);$(".js-total-num").text(Translator.trans("subject.question_count",{count:e})),$("[data-type=".concat(t,"]")).find(".subject-data__num").text(Translator.trans("subject.question_count",{count:i}))}},{key:"updateTotalScoreText",value:function(t){var e,i=!(0<arguments.length&&void 0!==t)||t;this.isTestpaper()&&i&&(e=v()(this.questionOperate.getTotalScore()).toFixed(1),$(".js-total-score").text(Translator.trans("subject.total_score",{totalScore:e})))}},{key:"orderQuestionList",value:function(t,e,i){var n=t,s=t;e.nextAll(".subject-list-item").each(function(){$(this).find(".js-list-index").text(n),n++}),i.nextAll(".subject-item").not(".subject-sub-item").each(function(){$(this).find(".subject-item__number").text(s),s++})}},{key:"finishImport",value:function(t){var e,i,n,s,a;this.isEditing()||(e=!1,n="",(i=this).$element.find(".subject-list-item__num--error").each(function(){n=n+$(this).find(".js-list-index").text()+"、",e=!0}),n=Translator.trans("subject.question_error_tip",{seqs:n.substring(0,n.length-1)}),e?cd.message({type:"danger",message:n}):this.isMaterialHasSub()&&(s=this.isTestpaper()?this.testpaperTitle:"",(a=$(t.currentTarget)).button("loading"),$.ajax({type:"POST",url:a.data("url"),data:p()({title:s,questions:this.questionOperate.getQuestions()}),dataType:"json",contentType:"application/json;charset=utf-8",success:function(t){!0===t&&(a.button("reset"),cd.message({type:"success",message:Translator.trans("subject.save_success")}),i.redirect=!0,window.location.href=a.data("redirectUrl"))}})))}},{key:"isMaterialHasSub",value:function(){for(var t=this.questionOperate.getTokenList(),e=0;e<t.length;e++){var i=t[e],n=this.questionOperate.getQuestion(i);if("material"===n.type&&0===n.subQuestions.length){var s=this.questionOperate.getQuestionOrder(i);return cd.message({type:"danger",message:Translator.trans("subject.material_nosub_tip",{seq:s})}),!1}}return!0}},{key:"statErrorQuestions",value:function(){var t="",e=!1;this.$element.find(".subject-list-item__num--error").each(function(){t=t+$(this).find(".js-list-index").text()+"、",e=!0}),t=Translator.trans("subject.question_error_tip",{seqs:t.substring(0,t.length-1)}),e?$(".js-error-tip").html(t):$(".js-error-tip").html("")}},{key:"addModalShow",value:function(t,e){var i,n,s;this.isEditing()||(i=$(t.currentTarget),n=$("#cd-modal"),s=i.closest(".js-subject-item").attr("id"),e?(n.find('[data-type="material"]').addClass("hidden"),n.attr("data-sub","true")):(n.find('[data-type="material"]').removeClass("hidden"),n.attr("data-sub","false")),n.attr("data-index",s),n.modal("show"))}},{key:"isEditing",value:function(){var t=$(".js-subject-edit-item"),e=t.hasClass("js-sub-edit-item"),i="";if(0===t.length)return!1;var n,s,a=t.find(".js-edit-form-seq").text();e&&(n=t.find(".js-hidden-token").val(),s=$("#".concat(n)).find(".js-subject-item-number").text(),i=$.trim(s));var r=e?Translator.trans("subject.sub_is_editing_warning",{parentNum:i,seq:a}):Translator.trans("subject.is_editing_warning",{seq:a});return cd.message({type:"warning",message:r}),!0}},{key:"questionTypeConvert",value:function(t,e){var i=$(".js-subject-list").find("[data-anchor=#".concat(e,"]"));i.find(".js-show-checkbox").attr("data-type",t),i.next(".js-type-name").text(this.getTypeName(t))}},{key:"getTypeName",value:function(t){switch(t){case"single_choice":return Translator.trans("course.question.type.single_choice");case"uncertain_choice":return Translator.trans("course.question.type.uncertain_choice");case"choice":return Translator.trans("course.question.type.choice");case"determine":return Translator.trans("course.question.type.determine");case"essay":return Translator.trans("course.question.type.essay");case"fill":return Translator.trans("course.question.type.fill");case"material":return Translator.trans("course.question.type.material");default:return Translator.trans("course.question.type.unknown")}}},{key:"ieImg",value:function(){(x.a.ie10||x.a.ie11)&&this.$itemList.addClass("ie-item-list")}}],[{key:"_serializeArrayConvertToJson",value:function(t){var e,i={},n=it(t);try{for(n.s();!(e=n.n()).done;){var s=e.value;i[s.name]?(i[s.name].push||(i[s.name]=[i[s.name]]),i[s.name].push(s.value)):i[s.name]=s.value}}catch(t){n.e(t)}finally{n.f()}return i}}]),m}();new st}});