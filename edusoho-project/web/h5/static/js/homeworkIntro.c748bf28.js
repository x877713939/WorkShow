(window.webpackJsonp=window.webpackJsonp||[]).push([["homeworkIntro"],{a23b:function(t,e,r){"use strict";r.r(e),r("8e6e"),r("ac6a"),r("456d"),r("e7e5");var n=r("d399"),o=r("bd86"),i=r("3ce7"),s=r("2f62"),a=r("ea9a"),u=r("c8a5");function c(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function h(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?c(Object(r),!0).forEach((function(e){Object(o.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var l={name:"HomeworkIntro",mixins:[a.a,u.a],data:function(){return{courseId:null,taskId:null,homework:null}},computed:h({hasResult:function(){return!!this.homework.latestHomeworkResult}},Object(s.d)({isLoading:function(t){return t.isLoading},user:function(t){return t.user}})),created:function(){this.getInfo(),this.initReport()},beforeRouteEnter:function(t,e,r){document.getElementById("app").style.background="#f6f6f6",r()},beforeRouteLeave:function(t,e,r){document.getElementById("app").style.background="",r()},methods:h(h({},Object(s.b)("course",["handHomeworkdo"])),{},{getInfo:function(){var t=this;this.courseId=this.$route.query.courseId,this.taskId=this.$route.query.taskId,i.a.getHomeworkIntro({query:{courseId:this.courseId,taskId:this.taskId}}).then((function(e){t.homework=e.homework,t.interruption()}))},initReport:function(){this.initReportData(this.$route.query.courseId,this.taskId,"homework",!1)},interruption:function(){var t=this;this.canDoing(this.homework.latestHomeworkResult,this.user.id).then((function(){t.startHomework()})).catch((function(e){var r=e.answer;t.submitHomework(r)}))},showResult:function(){this.$router.push({name:"homeworkResult",query:{homeworkId:this.homework.id,homeworkResultId:this.homework.latestHomeworkResult.id,courseId:this.$route.query.courseId,taskId:this.taskId}})},startHomework:function(){this.$router.push({name:"homeworkDo",query:{targetId:this.taskId,homeworkId:this.homework.id,courseId:this.$route.query.courseId},params:{KeepDoing:!0}})},submitHomework:function(t){var e=this,r={answer:t,homeworkId:this.homework.id,userId:this.user.id,homeworkResultId:this.homework.latestHomeworkResult.id};this.handHomeworkdo(r).then((function(t){e.reprtData("finish"),e.showResult()})).catch((function(t){n.a.fail(t.message)}))}})},d=r("a6c2"),p=Object(d.a)(l,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t.isLoading?r("e-loading"):t._e(),t.homework?r("div",{staticClass:"intro-body"},[r("van-panel",{staticClass:"panel intro-panel",attrs:{title:"作业名称"}},[r("div",{staticClass:"intro-panel__content intro-panel__content--title"},[t._v(t._s(t.homework.name))])]),r("van-panel",{staticClass:"panel intro-panel",attrs:{title:"作业说明"}},[r("div",{staticClass:"intro-panel__content",domProps:{innerHTML:t._s(t.homework.description)}})])],1):t._e(),t.homework?r("div",{staticClass:"intro-footer"},[t.hasResult?r("van-button",{staticClass:"intro-footer__btn",attrs:{type:"primary"},on:{click:t.showResult}},[t._v("查看结果")]):r("van-button",{staticClass:"intro-footer__btn",attrs:{type:"primary"},on:{click:function(e){return t.startHomework()}}},[t._v("开始答题")])],1):t._e()],1)}),[],!1,null,null,null);e.default=p.exports},c8a5:function(t,e,r){"use strict";var n=r("3ce7"),o=r("faa5");e.a={data:function(){return{reportIntervalTime:null,reportLearnTime:null,reportFinishCondition:null,reportData:{courseId:null,taskId:null},reportResult:null,isFinish:!1,reportType:null,learnTime:0}},beforeDestroy:function(){this.clearReportIntervalTime()},methods:{initReportData:function(t,e,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.clearReportIntervalTime(),this.reportData={courseId:t,taskId:e},this.reportType=r,this.isFinish=!1,this.reportIntervalTime=null,this.reportLearnTime=null,this.reportResult=null,this.learnTime=0,this.reportFinishCondition=null,n&&this.initReportEvent()},initReportEvent:function(){this.reprtData(),this.intervalReportData(),this.intervalReportLearnTime()},getCourseData:function(t,e){var r=this,o={courseId:t,taskId:e};return new Promise((function(t,e){n.a.getCourseData({query:o}).then((function(e){r.reportFinishCondition=e.activity.finishCondition,t(e)})).catch((function(t){e(t)}))}))},reprtData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"doing",r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!==this.reportData.courseId&&null!==this.reportData.taskId&&(!this.isFinish||r)){var i={};if("doing"===e){if(null!==this.reportResult){var s=this.reportResult.lastTime;i={lastTime:s}}o&&(i.watchTime=o)}var a={courseId:this.reportData.courseId,taskId:this.reportData.taskId,events:e};return new Promise((function(e,r){n.a.reportTask({query:a,data:i}).then((function(r){t.handleReprtResult(r),e(r)})).catch((function(t){r(t)}))}))}},handleReprtResult:function(t){this.reportResult=t,"finish"===t.result.status?(this.isFinish=!0,this.$store.commit(o.r,"finish"),this.$store.commit("course/".concat(o.v),t.completionRate)):this.$store.commit(o.r,"start")},intervalReportLearnTime:function(){var t=this;this.reportLearnTime=setInterval((function(){t.checkoutTime(),t.learnTime++}),1e3)},intervalReportData:function(){var t=this,e=60*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*1e3;this.reportIntervalTime=setInterval((function(){t.reprtData("doing",!0)}),e)},checkoutTime:function(){this.reportFinishCondition&&"time"===this.reportFinishCondition.type&&parseInt(this.learnTime/60,10)>=parseInt(this.reportFinishCondition.data,10)&&this.reprtData("finish")},clearReportIntervalTime:function(){clearInterval(this.reportIntervalTime),clearInterval(this.reportLearnTime),this.reportIntervalTime=null,this.reportLearnTime=null}}}},ea9a:function(t,e,r){"use strict";r("e17f");var n=r("2241");r("456d"),r("ac6a"),e.a={methods:{canDoing:function(t,e){return new Promise((function(r,o){if(t&&"doing"===t.status){var i="homework-".concat(e,"-").concat(t.id),s=JSON.parse(localStorage.getItem(i));s=s?Object.keys(s).forEach((function(t){s[t]=s[t].filter((function(t){return""!==t}))})):{},n.a.confirm({title:"提示",cancelButtonText:"放弃做题",confirmButtonText:"继续做题",message:"您有未完成的作业，是否继续？"}).then((function(){r()})).catch((function(){o({answer:s})}))}}))}}}}}]);